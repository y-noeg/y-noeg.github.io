"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8657],{70974:function(e,t,i){var n=i(67294),r=i(73935),o=i(12464),a=i(13433),s=i(60864),l=i(85893);t.Z=e=>{let{node:t,dragPosition:i,scaleToPage:d,containerZIndex:c}=e;const{0:u,1:p}=(0,n.useState)(null),g=(0,a.l)(s.k6),{x:h,y:f}=i||{x:0,y:0};return(0,n.useEffect)((()=>{const e=[`translate(${h}px, ${f}px)`];d&&e.push(`scale(${g})`);const t=document.createElement("div");return t.style.cssText=`\n      position: absolute;\n      top: 0;\n      left: 0;\n\n      pointer-events: none;\n      transform: ${e.join(" ")};\n\n      ${Number.isInteger(c)?`z-index: ${c};`:""}\n    `,p(t),document.body.appendChild(t),()=>{document.body.removeChild(t)}}),[c,g,d,h,f]),u?(0,r.createPortal)((0,l.jsx)(o.t0,{node:t}),u):null}},17009:function(e,t,i){i.d(t,{DY:function(){return s},_v:function(){return l},lr:function(){return d},mP:function(){return o},pf:function(){return a}});var n=i(59016),r=i(13285);const o=n.ZP.div.withConfig({displayName:"Tooltipstyles__TooltipDisplayWrapper",componentId:"sc-1brwmgd-0"})([""]),a=n.ZP.div.withConfig({displayName:"Tooltipstyles__TooltipWrapper",componentId:"sc-1brwmgd-1"})(["display:inherit;flex-direction:inherit;"]),s=(0,n.ZP)(r.E.div).withConfig({displayName:"Tooltipstyles__TooltipContainer",componentId:"sc-1brwmgd-2"})(["position:absolute;white-space:nowrap;width:fit-content;"]),l=n.ZP.div.withConfig({displayName:"Tooltipstyles__TooltipContent",componentId:"sc-1brwmgd-3"})(["border-radius:6px;background:",";color:",";",";font-weight:500;font-size:","px;padding:6px;box-shadow:",";"],(e=>e.$background??"transparent"),(e=>e.theme.colors.tooltipTextColor),(e=>e.$background&&"backdrop-filter: blur(100px)"),12,(e=>{let{theme:t,$background:i}=e;return i?t.boxShadow.large:"none"})),d=n.ZP.span.withConfig({displayName:"Tooltipstyles__TooltipShortcut",componentId:"sc-1brwmgd-4"})(["background:",";height:16px;width:fit-content;min-width:16px;line-height:17px;display:inline-block;border-radius:2px;text-align:center;margin-left:8px;font-size:","px;"],(e=>e.theme.colors.tooltipShortcutBg),12)},71515:function(e,t,i){var n=i(59499),r=i(67294),o=i(73935),a=i(95421),s=i(50576),l=i(13270),d=i(59016),c=i(53098),u=i(17009),p=i(85893);function g(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function h(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?g(Object(i),!0).forEach((function(t){(0,n.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):g(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}t.Z=e=>{const{children:t,content:i,perpendicularOffset:n=0,placement:g="left",shortcuts:f,delay:m=200,offset:y=10,ignoreWrapper:v=!1,style:w,withBackground:b=!0,background:I,zIndex:P=c.Ue,tooltipStyle:x}=e,{0:T,1:O}=(0,r.useState)(!1),R=(0,d.Fg)(),{0:C,1:E}=(0,r.useState)({}),{0:j,1:S}=(0,r.useState)(),{0:D,1:_}=(0,r.useState)([]),k=(0,r.useRef)(),A=(0,r.useMemo)((()=>({x:"top",y:"top"})),[]),L={},Z=b?I||R.colors.tooltipBg:void 0;L.zIndex=P;const H={},M={},z={};switch(g){case"top":case"bottom":L.left="50%",L.transform="translateX(-50%)";break;case"right":case"left":L.top="50%",L.transform="translateY(-50%)"}switch(g){case"top":A.x="left",A.y="bottom";break;case"bottom":case"right":A.x="left",A.y="top";break;default:A.x="right",A.y="top"}(0,r.useEffect)((()=>()=>{k.current&&clearTimeout(k.current)}),[]);const N=(0,r.useCallback)((e=>{switch(g){case"right":return e.right+y;case"left":return window.innerWidth-e.left+y;default:return e.x+e.width/2+n}}),[g,y,n]),U=(0,r.useCallback)((e=>{switch(g){case"bottom":return e.bottom+y;case"top":return window.innerHeight-e.top+y;default:return e[A.y]+e.height/2+n}}),[g,A,y,n]),W=(0,r.useCallback)((t=>{const i=t.currentTarget.dataset.tooltipId;if(z[i]||e.tooltipDisabled)return;const n=H[i];let r;n&&(r=n());const o=M[i];S((e=>e!==r?r:e)),_((e=>(0,s.Z)(e,o)?e:o||[])),k.current&&clearTimeout(k.current),k.current=setTimeout((()=>{O((e=>e||!0))}),m);const a=t.currentTarget.getBoundingClientRect(),l=N(a),d=U(a);E((e=>e&&e[A.y]===d&&e[A.x]===l?e:{[A.y]:d,[A.x]:l}))}),[A,H,z]),$=(0,r.useCallback)((()=>{k.current&&clearTimeout(k.current),O((e=>!e&&e))}),[k]),F=(0,r.useCallback)((()=>{k.current&&clearTimeout(k.current),O((e=>!e&&e))}),[k]);(0,r.useEffect)((()=>(window.addEventListener("keydown",F),()=>{window.removeEventListener("keydown",F)})),[F]);const V=r.Children.map(t,(e=>{if(v){const t=r.Children.map(e.props.children,(e=>{const t=e;return r.isValidElement(t)?(0,p.jsx)(l.yF,{children:(t,i)=>{const n=e.key?i(e.key):t;H[n]=e.props.renderTooltip,M[n]=e.props.tooltipShortcuts,z[n]=e.props.disableTooltip;return(0,r.cloneElement)(e,h({"data-tooltip-id":n,onMouseOver:W},e.props))}}):e}));return(0,r.cloneElement)(e,h(h({},e.props),{},{children:t}))}return r.isValidElement(e)?(0,p.jsx)(l.yF,{children:(t,i)=>{const n=e.key?i(e.key):t;H[n]=e.props.renderTooltip,M[n]=e.props.tooltipShortcuts,z[n]=e.props.disableTooltip;return(0,r.cloneElement)(e,h({"data-tooltip-id":n,onMouseOver:W},e.props))}}):e})),B=i||j,J=f||D||[];let G;return G=document.body,(0,p.jsxs)(u.pf,{onMouseLeave:()=>{k.current&&clearTimeout(k.current),O(!1),E({})},onMouseDown:$,style:w,children:[(0,p.jsx)(l.Ot,{children:V}),(0,p.jsx)(a.M,{children:T&&C&&B&&(0,p.jsx)(u.mP,{children:G&&(0,o.createPortal)((0,p.jsx)(u.DY,{initial:{opacity:0,[A.x]:C[A.x],[A.y]:C[A.y]},animate:{opacity:1,[A.x]:C[A.x],[A.y]:C[A.y]},exit:{opacity:0,transition:{duration:0}},transition:{duration:.2,ease:[.4,0,.1,1]},style:L,children:(0,p.jsxs)(u._v,{$background:Z,style:x,children:[B,J.map((e=>(0,p.jsx)(u.lr,{children:e},e)))]})}),G)})})]})}},87987:function(e,t,i){i.d(t,{mA:function(){return ot},pu:function(){return rt},R6:function(){return nt},ZP:function(){return st}});var n=i(59499),r=i(13433),o=i(13285),a=i(67294),s=i(4480),l=i(59016),d=i(78963),c=i(24656),u=i(22817),p=i(97210),g=i(24418),h=i(60864),f=i(57509),m=i(37189);const y=/--.*[^)]/;var v=()=>{const e=(0,a.useCallback)(((e,t)=>{var i;return e.getPropertyValue((null===(i=t.match(y))||void 0===i?void 0:i[0])??t)}),[]);return{getComputedColors:(0,a.useCallback)(((t,i)=>{let n=[];if(t.current){const r=getComputedStyle(t.current);n=i.map((t=>e(r,t)))}return n}),[e])}},w=i(55204),b=i(98982),I=i(31678),P=i(83887),x=i(27453),T=i(64310),O=i(73054),R=i(17463),C=i(33002),E=i(17704),j=i(24955);function S(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function D(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?S(Object(i),!0).forEach((function(t){(0,n.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):S(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var _=e=>{let{addTilesInPage:t}=e;const i=(0,s._8)((e=>{let{set:i}=e;return(e,n,r)=>{const o=t(r,n);return o&&o.forEach(((t,n)=>{i((0,R.vw)(t),(0,R.aY)(e[n]))})),o}}),[t]),n=(0,a.useCallback)(((e,t,n)=>{const r=[];return t.forEach((e=>{"IMAGE"===e?r.push({type:"IMAGE",contentLink:null,imageAttributes:D({},E.A),mediaTileData:D({},O.R)}):"VIDEO"===e&&r.push({type:"VIDEO",videoTileData:D({},C.C),mediaTileData:D({},O.R)})})),r.length?i(n,e,r):null}),[i]),r=(0,a.useCallback)(((e,t)=>{const i=[],r=[],o=[];return e.forEach((e=>{(0,j.QQ)(e)?(i.push(e),o.push("IMAGE")):e.type.startsWith("video/")?(i.push(e),o.push("VIDEO")):r.push(e)})),n(t,o,e),r}),[n]);return{onMultiDrop:r}},k=i(27618),A=i(46253),L=i(40105),Z=i(37865),H=i(4034),M=i(90170),z=i(95821);var N=l.vJ`
// A powerful override that can remove the cursor
body, body * {
  cursor: none !important;
  user-select: none !important;
  -webkit-user-select: none !important;
}
`,U=i(92627),W=i(88989);let $;!function(e){e.ACTIVE="active",e.SHOW="show",e.HIDE="hide",e.ALERT="alert",e.ALERT_HIDE="alert hide"}($||($={}));const F={[$.ACTIVE]:{opacity:.25,transition:{duration:0}},[$.SHOW]:{opacity:.2,transition:{duration:0}},[$.HIDE]:{opacity:0,transition:{duration:.2}},[$.ALERT]:{opacity:1,transition:{duration:0}},[$.ALERT_HIDE]:{opacity:0,transition:{duration:0}}};var V=i(78374);const B=(0,l.ZP)(o.E.div).withConfig({displayName:"Resizestyles__Target",componentId:"sc-1ibc3e6-0"})(["display:grid;place-items:center;position:absolute;",""],(e=>{let{$variant:t}=e;switch(t){case"vertical":return"\n          cursor: ew-resize;\n        ";case"horizontal":return"\n          cursor: ns-resize;\n          height: 100%;\n          width: 100%;\n        ";default:return""}})),J=l.ZP.div.attrs((e=>{const t={borderRadius:e.$pagePadding/2};switch(e.$variant){case"vertical":t.height="56px",t.width="4px";break;case"horizontal":t.width="50%",t.height="4px"}return{style:t}})).withConfig({displayName:"Resizestyles__Handle",componentId:"sc-1ibc3e6-1"})(["background:",";pointer-events:none;"],(e=>{let{theme:t,$alert:i}=e;return i?t.colors.red:t.colors.resizeHandle})),G=l.ZP.div.withConfig({displayName:"Resizestyles__TooltipTarget",componentId:"sc-1ibc3e6-2"})(["width:","px;display:flex;justify-content:center;pointer-events:",";"],(e=>{let{pagePadding:t}=e;return 2*t}),(e=>{let{enabled:t}=e;return t?"auto":"none"}));var Y=i(85893);var q=e=>{let{onResizeStart:t,onResize:i,onResizeComplete:n,enabled:r,pagePadding:o}=e;const{0:l,1:d}=(0,a.useState)(!1),{scrollingPageRef:c}=(0,a.useContext)(U.Z),u=(0,s.Zl)(V.lk),{scrollContainerIfNeeded:p,cancelAnyScrolling:g}=(0,W.Z)(),h=(0,a.useRef)(0),f=(0,a.useRef)(0),m=(0,a.useRef)(0),y=(0,a.useRef)(0),v=(0,a.useRef)(i);v.current=i;const w=(0,a.useRef)(n);w.current=n;const b=(0,a.useCallback)((e=>{p(e);const t=e.pageY-h.current;m.current=t,v.current(m.current+y.current)}),[p]),I=(0,a.useCallback)((()=>{const e=c.current.scrollTop-f.current;y.current=e,v.current(m.current+y.current)}),[c]),P=(0,a.useCallback)((()=>{c.current.removeEventListener("scroll",I),window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",P),g(),w.current(),d(!1),u(!1),m.current=0,y.current=0}),[g,b,I,c,u]),x=(0,a.useCallback)((e=>{d(!0),u(!0),e.preventDefault(),t(),h.current=e.pageY,f.current=c.current.scrollTop,c.current.addEventListener("scroll",I),window.addEventListener("mousemove",b),window.addEventListener("mouseup",P),p(e)}),[t,c,I,b,P,p,u]);return(0,Y.jsxs)(B,{$variant:"horizontal","data-testid":"row_resize_handle",variants:F,initial:$.HIDE,whileHover:l?$.ACTIVE:$.SHOW,animate:l?$.ACTIVE:$.HIDE,style:{pointerEvents:r?"auto":"none"},onMouseDown:x,children:[(0,Y.jsx)(J,{$variant:"horizontal",$pagePadding:o,$alert:!1}),l&&(0,Y.jsx)(N,{})]})};const K=l.ZP.div.withConfig({displayName:"HorizontalPageRowGutter__Container",componentId:"sc-1a3d399-0"})(["position:relative;width:100%;"]);var X=e=>{let{children:t,style:i}=e;return(0,Y.jsx)(K,{style:i,children:t})},Q=i(67156),ee=i(40556),te=i(20543),ie=i(53098);var ne=e=>{let{as:t,indicatorTargetId:i,style:n={},onDrop:r,dataTestId:o}=e;const l=(0,s.Zl)((0,V.fz)(i)),d=(0,s.Zl)(V.M9),c=(0,a.useCallback)((e=>{e.preventDefault(),l(!0),d(i)}),[i,d,l]),u=(0,a.useCallback)((e=>{e.preventDefault(),l(!0),d(i)}),[i,d,l]),p=(0,a.useCallback)((e=>{e.preventDefault(),l(!1),d(null)}),[d,l]),g=(0,s._8)((e=>{let{snapshot:t}=e;return e=>{if(e.preventDefault(),l(!1),d(null),"function"===typeof r){const i=t.getLoadable(V.LY).getValue();r({e:e,dndData:i})}}}),[l,d,r]);return(0,Y.jsx)(t,{"data-testid":o,onMouseEnter:c,onMouseOver:u,onMouseLeave:p,onPointerUp:g,onDragEnter:c,onDragLeave:p,onDragOver:u,onDrop:g,style:n})};const re=(0,l.ZP)(o.E.div).withConfig({displayName:"DropZoneIndicator__Indicator",componentId:"sg23uz-0"})(["background-color:",";border-radius:99px;position:absolute;"],(e=>e.theme.colors.contentAccent)),oe=(0,l.ZP)(re).withConfig({displayName:"DropZoneIndicator__VerticalIndicator",componentId:"sg23uz-1"})(["width:","px;height:100%;"],Q.cn),ae=(0,l.ZP)(re).withConfig({displayName:"DropZoneIndicator__HorizontalIndicator",componentId:"sg23uz-2"})(["height:","px;width:calc(100% - ","px);"],Q.cn,Q.j);var se=e=>{let{indicatorId:t,dataTestId:i,style:n,orientation:r}=e;const o=(0,s.sJ)((0,V.fz)(t));let a;switch(r){case"horizontal":a=ae;break;case"vertical":a=oe}return(0,Y.jsx)(a,{"data-testid":i,style:n,initial:{opacity:0},transition:{duration:.15,type:"tween"},animate:{opacity:o?1:0}})},le=i(44588);function de(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function ce(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?de(Object(i),!0).forEach((function(t){(0,n.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):de(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const ue=l.ZP.div.withConfig({displayName:"RowHorizontalDropZone__Container",componentId:"sc-1okr71w-0"})(["position:absolute;width:100%;"]),pe=l.ZP.div.withConfig({displayName:"RowHorizontalDropZone__StyledDropZone",componentId:"sc-1okr71w-1"})(["position:absolute;z-index:",";left:-","px;"],ie.xG,1.5*Q.j);var ge=e=>{let{indicatorId:t,onDrop:i,enabled:n,indicatorStyle:r,dropzoneStyle:o,displayIndicator:a,debugMode:s}=e;return(0,le.Z)()&&n||s?(0,Y.jsxs)(ue,{children:[(a||s)&&(0,Y.jsx)(se,{style:r,indicatorId:t,dataTestId:"flexitome_row_dropzone_indicator",orientation:"horizontal"}),(0,Y.jsx)(ne,{as:pe,dataTestId:"flexitome_row_dropzone",indicatorTargetId:t,onDrop:i,style:ce(ce({},o),s?{background:"rgba(255, 100, 100, 0.7)"}:{})})]}):null};function he(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function fe(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?he(Object(i),!0).forEach((function(t){(0,n.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):he(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const me=l.ZP.div.withConfig({displayName:"VerticalDropZone__Container",componentId:"ife6na-0"})(["position:relative;visibility:",";"],(e=>e.$dragInProgress?"visible":"hidden")),ye=l.ZP.div.withConfig({displayName:"VerticalDropZone__DropZoneContainer",componentId:"ife6na-1"})(["position:absolute;left:0;width:100%;"]),ve=l.ZP.div.withConfig({displayName:"VerticalDropZone__StyledDropZone",componentId:"ife6na-2"})(["position:absolute;"]),we=(e,t,i,n,r)=>(0,Y.jsx)(ne,{as:ve,dataTestId:"flexitome_tile_dropzone",indicatorTargetId:t,onDrop:i,style:r},e);var be=e=>{let{children:t,tileIds:i,rowCanHoldMoreTiles:n,tomeId:r,pageId:o,rowId:l,rowIdx:d,enabled:c,dropHandler:u,disabledDropzones:p,dropzoneContainerStyle:g,debugMode:h,pageWidth:f,pagePadding:m}=e;const y=(0,s.sJ)(V.sA),v=y&&i.includes(y),{getMainController:w}=(0,a.useContext)(ee.Z),b=w(o),I=[];for(let a=0;a<=i.length;a++){p.includes(a);const e=0===a;let t;const s=a===i.length;t=n||!s||v?{tomeId:r,pageId:o,kind:"vertical",rowId:l,tileIdx:a}:{tomeId:r,pageId:o,kind:"horizontal",rowIdx:d+1};const c=i[a]??i[a-1],g=b.getTilePosition(c,f,m),y=fe(fe({},h?{backgroundColor:"rgba(0, 0, 0, 0.2)",border:"1px solid lime"}:{}),{},{height:"100%",width:g.width/2+1.5*Q.j,left:g.left+g.width/2-m});if(e&&(y.left=1.5*-Q.j),!e&&!s){const e=b.getTilePosition(i[a-1],f,m);y.left=e.left+e.width/2-m,y.width=e.width/2+g.width/2+m}s&&(y.left=g.left+g.width/2-m),I.push(we(a,t,u({kind:te.r.EXISTING_ROW,rowId:l,newTileIdx:a}),0,y))}const P=(0,le.Z)();return(0,Y.jsxs)(me,{$dragInProgress:!!P||h,children:[t,c&&(P||h)&&(0,Y.jsx)(ye,{style:fe({},g),children:I})]})};const Ie=l.ZP.div.withConfig({displayName:"VerticalIndicator__Container",componentId:"sc-1k3clls-0"})(["width:100%;height:100%;"]);var Pe=e=>{let{debugMode:t,indicatorId:i}=e;const n=(0,le.Z)();return t||n?(0,Y.jsx)(Ie,{children:(0,Y.jsx)(se,{indicatorId:i,dataTestId:"flexitome_tile_dropzone_indicator",orientation:"vertical"})}):null};const xe=l.ZP.div.withConfig({displayName:"VerticalTileGutter__Container",componentId:"e9424p-0"})(["position:absolute;height:100%;",""],(e=>e.$debugMode&&"background-color: rgba(0, 0, 255, 0.4);"));var Te=e=>{let{children:t,debugMode:i,style:n}=e;return(0,Y.jsx)(xe,{$debugMode:i,style:n,children:t})},Oe=i(1922),Re=i(71515),Ce=i(40312),Ee=i(39626);var je=e=>{let{onResizeStart:t,onResize:i,onResizeComplete:n,pagePadding:r,rowIndex:o,tileIndex:l,tilePosition:d,pageWidth:c}=e;const u=d.left-1.5*r,{0:p,1:g}=(0,a.useState)(!1),{0:h,1:f}=(0,a.useState)(!1),m=(0,le.Z)(),y=(0,s.sJ)(V.lk),[v,w]=(0,s.FV)(V.MJ),b=!m&&!y&&(!v||p),I=(0,a.useRef)(0),P=(0,a.useRef)(i);P.current=i;const x=(0,a.useRef)(n);x.current=n;const T=(0,a.useCallback)((e=>{const t=e.pageX-I.current,i=P.current(t);f(i===Ee.yV.REACHED_MINIMUM)}),[]),O=(0,a.useCallback)((()=>{g(!1),w(!1),f(!1),window.removeEventListener("mousemove",T),window.removeEventListener("mouseup",O),x.current()}),[T,w]),R=(0,a.useCallback)((e=>{g(!0),w(!0),t(e.altKey),I.current=e.pageX,window.addEventListener("mousemove",T),window.addEventListener("mouseup",O)}),[T,O,t,w]),C=d.left<c/2?"right":"left",E=h?$.ALERT:$.ACTIVE,j=h?$.ALERT_HIDE:$.HIDE,{t:S}=(0,Oe.$G)();return(0,Y.jsxs)(B,{"data-testid":"tile_resize_handle","data-testid-resize-position":`${o}-${l}`,$variant:"vertical",style:{top:d.top,height:d.height,left:u,width:2*r,pointerEvents:b?"auto":"none"},variants:F,initial:$.HIDE,whileHover:p?E:$.SHOW,animate:p?E:j,onMouseDown:R,children:[(0,Y.jsx)(Re.Z,{content:S("pageLayout.resizeHandles.tileWidthResizeHandle.resizeAdjacentHandle"),shortcuts:[(0,Ce.C6)(),"\u2194"],placement:C,tooltipDisabled:!b,delay:500,offset:8,children:(0,Y.jsx)(G,{pagePadding:r,enabled:b,"data-testid":"tooltip_target",children:(0,Y.jsx)(J,{$variant:"vertical",$pagePadding:r,$alert:p&&h})})}),p&&(0,Y.jsx)(N,{})]})};var Se=e=>{let{pageId:t,rowId:i,rowIndex:n,sizes:r,tileId:o,tileIndex:s}=e;const{pageSizes:l}=r,{getMainController:d}=(0,a.useContext)(ee.Z),c=d(t),u=c.getTilePosition(o,l.width,l.padding),{handleResizeStart:p,handleResize:g,handleResizeComplete:h}=(0,a.useMemo)((()=>c.getTileResizeHandlers(s,i,l.width)),[c,s,i,l.width]);return(0,Y.jsx)(je,{rowIndex:n,tileIndex:s,onResizeStart:p,onResize:g,onResizeComplete:h,tilePosition:u,pagePadding:l.padding,pageWidth:l.width},o)};const De=l.ZP.div.withConfig({displayName:"RowInteractivity__TilesOverlayContainer",componentId:"sc-2r5wwz-0"})(["width:100%;",""],(e=>e.$debugMode&&"background-color: rgba(0, 255, 0, 0.4);"));var _e=e=>{let{page:t,sizes:i,row:n,rowIdx:o,tomeId:l,rowHeightInUnits:d,isFirstRow:c,isLastRow:u,debugMode:f=!1}=e;const{pageSizes:m,rowSizes:y}=i,v=(0,r.l)(h.oG),w=(0,s.sJ)(p.Hl),b=(0,s.Zl)((0,Z.$)(l)),{apolloClient:I,clientId:P}=(0,g.bp)(),[x,O]=(0,s.FV)(V.sA),{getMainController:R}=(0,a.useContext)(ee.Z),C=R(t.id),E=(0,H.t2)(),j=(0,a.useCallback)(((e,i)=>{if(!e.length)return null;const n=(0,z.ln)(l,t.id,C,e,I,P,i);return(0,h.Dm)(n[0]),E.setPropertyPanel(M.Z.TILE),n}),[I,P,t.id,C,E,l]),{onMultiDrop:S}=_({addTilesInPage:j}),D=(0,L.Z)(((e,t)=>{let{e:i,dndData:n}=t;if((0,A.X)(i)&&(0,A.C)(i)){const t=i.dataTransfer.files,n=[];for(let e=0;e<t.length&&e<16;e++)n.push(t[e]);T.v.addAction("Drag to add media",{files:n.map((e=>({name:e.name,type:e.type})))});const r=S(n,e);r.length>0&&(b({title:"This file format is not yet supported.",subtitle:"Drag a supported image or video file format."}),T.v.addAction("Unsupported media format after dragging",{file:r.map((e=>({name:e.name,type:e.type})))}))}else if(n)switch(n.kind){case k.A.ADD_TILE:{const t={type:n.typeType};j([t],e)}break;case k.A.MOVE_TILE:O(null),C.moveTile(n.tileId,e)}}),[S,b,O,C,j]),{handleResizeStart:N,handleResize:U,handleResizeComplete:W}=(0,a.useMemo)((()=>C.getRowResizeHandlers(n.id)),[C,n.id]),$=e=>({tomeId:l,pageId:t.id,kind:"horizontal",rowIdx:e}),F=e=>({tomeId:l,pageId:t.id,kind:"vertical",rowId:n.id,tileIdx:e}),B=(0,a.useMemo)((()=>C.findNoopDropzones(x)),[x,C]),J=(0,a.useCallback)((e=>B.horizontal.includes(e)),[B.horizontal]),G=(0,a.useCallback)((()=>{const e=B.vertical.find((e=>e.rowIdx===o));return e?e.indices:[]}),[B.vertical,o]),K=y.unitRowHeight*d,ie=K-m.padding,ne=K*Q.p3;return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(ge,{enabled:!v&&!J(o),indicatorId:$(o),onDrop:D({kind:te.r.NEW_ROW,newRowIdx:o}),displayIndicator:c,indicatorStyle:{top:c?0:m.padding/2-Q.cn/2},dropzoneStyle:{top:c?-Q.tS-m.padding/2:-m.padding/2,height:c?Q.tS+ne:ne,width:m.width+2*Q.j},debugMode:f}),(0,Y.jsx)(be,{tileIds:n.tiles.map((e=>e.tileId)),rowCanHoldMoreTiles:n.canAddMoreTiles(),tomeId:l,pageId:t.id,rowId:n.id,rowIdx:o,enabled:!v,dropHandler:D,disabledDropzones:G(),dropzoneContainerStyle:{top:ne-m.padding/2,height:3*ne},debugMode:f,pageWidth:m.width,pagePadding:m.padding,children:(0,Y.jsx)(De,{$padding:m.padding,$debugMode:f,"data-testid":"page_row",style:{height:`${ie}px`},children:n.tiles.map(((e,t)=>{const{tileId:i}=e,r=C.getTilePosition(i,m.width,m.padding),o=r.left+r.width-m.padding/2-Q.cn/2,s=r.left+r.width-m.padding;return(0,Y.jsxs)(a.Fragment,{children:[0===t&&(0,Y.jsx)(Te,{debugMode:f,style:{left:-Q.cn},children:(0,Y.jsx)(Pe,{debugMode:f,indicatorId:F(0)})}),(0,Y.jsx)(Te,{debugMode:f,style:{left:t<n.tiles.length-1?o:s},children:(0,Y.jsx)(Pe,{debugMode:f,indicatorId:F(t+1)})})]},i)}))})}),n.tiles.map(((e,r)=>0===r?null:(0,Y.jsx)(Se,{pageId:t.id,tileIndex:r,rowIndex:o,rowId:n.id,sizes:i,tileId:e.tileId},e.tileId))),(0,Y.jsx)(ge,{indicatorId:$(o+1),onDrop:D({kind:te.r.NEW_ROW,newRowIdx:o+1}),enabled:!J(o+1),indicatorStyle:{top:m.padding/2-Q.cn/2},dropzoneStyle:{bottom:u?-Q.tS-m.padding/2:-m.padding/2,height:u?Q.tS+ne:ne,width:m.width+2*Q.j},displayIndicator:!0,debugMode:f}),(0,Y.jsx)(X,{style:{height:m.padding},children:(0,Y.jsx)(q,{onResizeStart:N,onResize:U,onResizeComplete:W,enabled:!w&&!v,pagePadding:m.padding})})]})},ke=i(20286),Ae=i(85769),Le=i(33340),Ze=i(51718);const He=l.ZP.div.withConfig({displayName:"TileSelectionWrapper__Highlight",componentId:"sc-1ot5lz9-0"})(["position:absolute;top:0;left:0;right:0;bottom:0;border-radius:","px;pointer-events:none;opacity:",";transition:opacity 0.2s ease;background-color:",";"],(e=>e.$radius),(e=>{let{$highlight:t}=e;return t?1:0}),(e=>{let{theme:t,tileType:i}=e;return i===Ze.YUT.Table?t.colors.tileHoverTable:t.colors.tileHover})),Me=l.ZP.div.withConfig({displayName:"TileSelectionWrapper__Selection",componentId:"sc-1ot5lz9-1"})(["position:absolute;top:0;left:0;right:0;bottom:0;border-radius:","px;pointer-events:none;box-shadow:",";opacity:",";"],(e=>e.$radius),(e=>`0px 0px 0px 2px ${e.$isSecondary?e.theme.colors.tileSecondarySelection:e.theme.colors.tilePrimarySelection}`),(e=>e.$selected&&!e.$disabled?1:0)),ze=l.ZP.div.withConfig({displayName:"TileSelectionWrapper__TileWrapper",componentId:"sc-1ot5lz9-2"})(["height:100%;width:100%;position:relative;display:flex;flex:1;top:0;overflow:visible;border-radius:","px;&:hover ","{",";}"],(e=>e.$radius),He,(e=>e.$hoverDisabled?"":"\n            opacity: 1;\n          "));var Ne=e=>{let{children:t,id:i,radius:n,preview:o,canEdit:a,tileType:l}=e;const c=(0,s.sJ)(d.cm),u=(0,s.sJ)(d.s5),g=(0,s.sJ)(p.Hl),f=(0,r.l)(h.oG),m=(0,s.sJ)(h.DH),y=(0,s.sJ)(Ae.SI),v=(0,s.sJ)((0,Le.pt)(i)),w=(0,r.l)(h.Dm),b=(0,r.l)(h.bT),I=(0,s.sJ)(V.sA),P=(0,s.sJ)(V.MJ),x=(0,s.sJ)(V.lk),T=(0,s.sJ)(V.GS),O=w===i,R=Boolean(c||u||m||f||I||x||P),C=null!==y||v,E=o||!a,j=P||x||b||I||T;return(0,Y.jsxs)(ze,{$radius:n,$hoverDisabled:O||R||g||E,children:[!E&&(0,Y.jsx)(He,{$highlight:!!j,$radius:n,tileType:l}),!E&&(0,Y.jsx)(Me,{"data-testid":"tile_selection",$selected:O,$disabled:R,$isSecondary:C,$radius:n}),t]})},Ue=i(60153),We=i(12464),$e=i(2372),Fe=i(70974);function Ve(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function Be(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?Ve(Object(i),!0).forEach((function(t){(0,n.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Ve(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const Je="tile-last-dragged-item",Ge=(0,l.ZP)(o.E.div).withConfig({displayName:"TilePositioner__AnimatedWrapper",componentId:"sc-3tpuzl-0"})(["position:absolute;&.","{pointer-events:none !important;z-index:1 !important;}"],Je),Ye={type:"spring",stiffness:110,damping:20,mass:1};var qe=e=>{let{children:t,position:i,tileId:n,preview:r,enableDrag:o,pageVerticalMargin:d,setTileIsAnimating:c,animatingBorderRadius:u,style:p}=e;const g=(0,Ue.o)(),f=(0,a.useRef)(null),{scrollContainerIfNeeded:m,cancelAnyScrolling:y}=(0,W.Z)(),{0:v,1:w}=(0,a.useState)(!1),{0:b,1:I}=(0,a.useState)({x:0,y:0}),{0:P,1:x}=(0,a.useState)(),{scrollingPageRef:T}=(0,a.useContext)(U.Z),O=(0,l.Fg)(),R=(0,a.useMemo)((()=>{const e=Be({},i);for(const t of Object.keys(e))Number.isNaN(e[t])&&delete e[t];return e}),[i]),C=(0,s.Zl)(V.sA),E=(0,s.Zl)(V.LY),j=(0,a.useMemo)((()=>({kind:k.A.MOVE_TILE,tileId:n})),[n]),S=(0,a.useCallback)((e=>{const t=e.target,i=document.activeElement,n=null!==t.closest("[data-disable-drag]"),r=null!==t.closest("[data-slate-editor]"),o=(null===i||void 0===i?void 0:i.isContentEditable)||"TEXTAREA"===(null===i||void 0===i?void 0:i.tagName);(n||r||e.currentTarget.contains(document.activeElement)&&o)&&g.componentControls.forEach((t=>{t.stop(e)}))}),[g]),D=(0,a.useCallback)((e=>{m(e)}),[m]),_=(0,a.useCallback)((e=>{if(f.current){var t;const i=f.current.getBoundingClientRect();I({x:e.pageX-i.x,y:e.pageY-i.y});const n=null===(t=f.current.offsetParent)||void 0===t?void 0:t.getBoundingClientRect();null!==n&&void 0!==n&&n.x&&null!==n&&void 0!==n&&n.y&&x({x:null===n||void 0===n?void 0:n.x,y:null===n||void 0===n?void 0:n.y})}w(!0),C(n),E(j)}),[C,E,j,n]),A=(0,a.useRef)(!1),L=(0,a.useCallback)((()=>{var e;y(),I({x:0,y:0}),w(!1),C(null),A.current=!0,c(n,!0),null===(e=f.current)||void 0===e||e.classList.add(Je)}),[y,f,C,c,n]),Z=(0,a.useRef)(!1),H=(0,a.useCallback)((()=>{if(!A.current&&!Z.current){0===c(n,!1)&&document.querySelectorAll(".tile-last-dragged-item").forEach((e=>{e.classList.remove(Je)}))}}),[c,n]),M=(0,a.useCallback)((e=>{"rest"!==e||r||(c(n,!0),Z.current=!0)}),[r,c,n]),z=(0,a.useCallback)((e=>{"rest"!==e||r||(Z.current=!1,H())}),[H,r]),N=(0,a.useCallback)((()=>{A.current=!1,H()}),[H]),$=(0,a.useMemo)((()=>(0,We.oD)()),[]),[F,B]=(0,s.FV)((0,h.Eq)(n)),J=(0,a.useCallback)((()=>{if(T.current){const e=T.current,t=e.scrollTop+e.clientHeight-O.headerHeight-d,i=R.top+R.height;i>=t?e.scrollTop+=i-t:R.top<e.scrollTop&&(e.scrollTop=R.top)}}),[R.height,R.top,d,T,O.headerHeight]);(0,a.useEffect)((()=>{!r&&F&&(J(),B(!1))}),[r,J,F,B]);const G={backgroundColor:v?O.colors.tilePositionWhileDragBackground:"unset",boxShadow:v?O.colors.tilePositionAnimatingShadow:"unset",transformOrigin:`${null===b||void 0===b?void 0:b.x}px ${null===b||void 0===b?void 0:b.y}px`,pointerEvents:"auto"};return $?(0,Y.jsxs)("div",{suppressHydrationWarning:!0,children:[(0,Y.jsx)(We.Nq,{node:$,children:(0,Y.jsx)(Ge,{ref:f,variants:{rest:Be(Be({},R),{},{transition:{duration:0}}),active:Be(Be({borderRadius:u},R),{},{transition:r?{duration:0}:Be(Be({},Ye),{},{duration:.3})})},initial:"rest",animate:v&&!r?"active":"rest",drag:o,dragControls:g,dragSnapToOrigin:!0,onPointerDown:S,onDragStart:_,onDrag:D,onDragEnd:L,onAnimationStart:M,onAnimationComplete:z,onDragTransitionEnd:N,style:Be(Be({},G),p),whileDrag:{opacity:.5,scale:.75,zIndex:ie.C8,pointerEvents:"none"},children:t})}),v?(0,Y.jsx)(Fe.Z,{scaleToPage:!0,dragPosition:P,node:$}):(0,Y.jsx)(We.t0,{node:$}),v&&(0,Y.jsx)($e.Z,{})]}):(0,Y.jsx)("div",{children:(0,Y.jsx)(Ge,{initial:R,style:G,children:t})})};const Ke=(0,a.forwardRef)(((e,t)=>{let{tile:i,enableDrag:n,position:r,preview:o,row:a,tomeId:s,sizes:l,activeDragInProgress:d,page:c,onTileResize:u,rowHeightinPx:p,rowIndex:g,tileIndex:h,isFirstPage:f,active:m,canEdit:y,pageVerticalMargin:v,setTileIsAnimating:w,pageKind:b,style:I}=e;const{tileSizes:P}=l;return(0,Y.jsx)(qe,{position:r,tileId:i.id,preview:o,enableDrag:n,pageVerticalMargin:v,setTileIsAnimating:w,animatingBorderRadius:l.tileSizes.radius,style:I,children:(0,Y.jsx)(Ne,{id:i.id,radius:P.radius,preview:o,canEdit:y,tileType:i.type,children:(0,Y.jsx)(ke.n,{ref:t,canEdit:y,isMobile:!1,isSingle:a.isSingleTile(),preview:o,tile:i,tomeId:s,sizes:l,page:c,activeDragInProgress:d,index:h,isFirstPage:f,isPageActive:m,isTileEndpoint:!1,disableAnnotations:!1,disableExpand:!1,onTileResize:u,rowHeight:p,rowIndex:g,rowId:a.id,tileIndex:h,pageKind:b})},`${i.id}-selection-wrapper`)})}));var Xe=Ke,Qe=i(71652);function et(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function tt(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?et(Object(i),!0).forEach((function(t){(0,n.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):et(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const it=l.ZP.div.withConfig({displayName:"Page__StackedPage",componentId:"sc-1omh4nr-0"})(["position:relative;display:flex;justify-content:center;"]),nt=(0,l.ZP)(o.E.div).withConfig({displayName:"Page__PageStyles",componentId:"sc-1omh4nr-1"})(["height:100%;position:relative;justify-content:start;align-items:center;@media ","{display:flex;flex-direction:column;}visibility:",";"],f.Hb.mobile,(e=>e.$preview||e.$isVisible?"visible":"hidden")),rt=l.ZP.div.withConfig({displayName:"Page__PageSelectionRing",componentId:"sc-1omh4nr-2"})([""]),ot=l.ZP.div.withConfig({displayName:"Page__PagePreviewWrapper",componentId:"sc-1omh4nr-3"})([""]),at=(e,t)=>{let{page:i,preview:n,active:o,isBot:f=!1,isVisible:y,canEdit:T,useEditablePage:O,tomeId:R,sizes:C,isFirstPage:E,pageVerticalMargin:j,pageKind:S,debugMode:D=!1,skipReportPresence:_=!1}=e;const{apolloClient:k,clientId:A}=(0,g.bp)(),L=(0,s.sJ)(d.cm),Z=(0,s.sJ)(d.s5),H=(0,r.l)(h.oG),M=(0,s.sJ)(h.DH),z=(0,s.sJ)(V.GS),N=(0,s.sJ)(p.Hl),U=(0,s.sJ)(p.tF),W=(0,s.sJ)((0,w.J)(R)),$=(0,l.Fg)(),F=(0,a.useRef)(null),{pageSizes:B,rowSizes:J}=C,G=(0,b.Z)(B.height),q=(0,a.useCallback)((()=>{u.z.reportViewPresence(k,A,R,i.id)}),[k,A,R,i.id]);(0,a.useEffect)((()=>{_||!n&&o&&q()}),[o,n,q,_]);const K=H&&!n&&o,X=H&&!n,{getComputedColors:Q}=v();(0,I.L)(i.theme),(0,a.useEffect)((()=>{if(!o)return;let e=$.colors.background;K&&(e=$.colors.page);const[t]=Q(F,[e]);t&&(0,m.A)(t)}),[o,Q,K,$.colors.background,$.colors.page]);const ee=((0,r.l)(h.bT)||z)&&o,te=(0,x.Z)({tomeId:R,pageId:i.id,pageKind:S,layout:i.layout,tiles:i.tiles,pixelsPerHeightUnit:J.unitRowHeight,rowPadding:B.padding,persistToBackend:!n}),ie=te.frontendPageLayout,ne=(0,a.useMemo)((()=>te.triggerLayoutRecalculationAndRender.bind(te)),[te]);(0,a.useEffect)((()=>{n&&ne()}),[n,ne]);const re=(0,a.useRef)(new Set),oe=(0,a.useCallback)(((e,t)=>(t?re.current.add(e):re.current.delete(e),re.current.size)),[re]),ae=(0,Y.jsxs)(Y.Fragment,{children:[ie.allTileIds.map((e=>{var t;const r=null===(t=i.tiles)||void 0===t?void 0:t.find((t=>t.id===e));if(!r)return null;const a=ie.rowByTileId(e);if(!a)return null;const s=te.getTilePosition(e,B.width,B.padding),l=!n&&o&&T&&!H&&!M&&!N&&!L&&!Z,d=te.getTileHeightInPx(a.id);return(0,Y.jsx)(Xe,{ref:te.tileRefCallback(e),tile:r,preview:n,position:s,enableDrag:l,row:a,tomeId:R,sizes:C,page:i,activeDragInProgress:ee,onTileResize:ne,rowHeightinPx:d,rowIndex:ie.rowIndex(a.id),tileIndex:a.tileIndex(e),isFirstPage:E,active:o,canEdit:T,pageVerticalMargin:j,setTileIsAnimating:oe,pageKind:S},r.id)})),o&&!n&&T&&O&&ie.rows.map(((e,t)=>(0,Y.jsx)(_e,{page:i,sizes:C,row:e,rowIdx:t,tomeId:R,rowHeightInUnits:te.getRowHeight(e.id),isFirstRow:0===t,isLastRow:t===ie.rows.length-1,debugMode:D},e.id)))]}),se=(0,Y.jsx)(Y.Fragment,{children:ie.rows.map((e=>e.tiles.map((t=>{var r;const a=null===(r=i.tiles)||void 0===r?void 0:r.find((e=>e.id===t.tileId));if(!a)return null;const{tileId:s}=t,l=te.getTileHeightInPx(e.id),d=te.getTilePosition(s,B.width,B.padding),c=!n&&o&&T&&!H&&!M&&!N&&!L&&!Z;return(0,Y.jsx)(Xe,{style:X?{transition:"opacity 0.5s cubic-bezier(0.33, 1, 0.68, 1)",opacity:f||G?1:0}:{},ref:te.tileRefCallback(s),tile:a,preview:n,position:d,enableDrag:c,row:e,tomeId:R,sizes:C,page:i,activeDragInProgress:ee,onTileResize:ne,rowHeightinPx:l,rowIndex:ie.rowIndex(e.id),tileIndex:e.tileIndex(s),isFirstPage:E,active:o,canEdit:T,pageVerticalMargin:j,setTileIsAnimating:oe,pageKind:S},a.id)}))))}),le=C.calculatePageHeight(te.sumOfRowHeightsInUnits()),de=()=>(0,Y.jsx)(nt,tt(tt({ref:t},o?{"data-testid":"active_page",id:"active_page"}:{}),{},{$isVisible:y,$preview:n,style:{height:`${le}px`,minHeight:B.height,width:B.width,borderRadius:n?0:B.radius,padding:`${B.padding}px ${B.padding}px 0`,backgroundColor:n||!M||H?$.colors.page:$.colors.background},children:O?ae:se}));return(0,Y.jsxs)(it,{ref:F,children:[!n&&o&&!W&&(0,Y.jsx)(P.Z,{overlayData:i.overlay,pageId:i.id,canEdit:T,tomeId:R,display:U,pageHeight:le,pageWidth:B.width,isMobile:!1,playMode:H&&S!==c.s.PAGE_ENDPOINT}),n?(0,Y.jsx)(rt,{"data-testid":"outline_selection_ring",children:(0,Y.jsx)(ot,{children:(0,Y.jsx)(Qe.Z,{theme:i.theme,children:de()})})}):(0,Y.jsx)(Y.Fragment,{children:de()})]})};var st=(0,a.memo)((0,a.forwardRef)(at))},83887:function(e,t,i){i.d(t,{Z:function(){return de}});var n=i(67294),r=i(4480),o=i(46513),a=i(4960),s=i(77774),l=i(77717),d=i(53098),c=i(51718),u=i(24418),p=i(24233),g=i(17463),h=i(8595),f=i(90170),m=i(4034),y=i(2372),v=i(41100),w=i(59499),b=i(62830),I=i.n(b),P=i(59016),x=i(64310),T=i(36828),O=i(48264),R=i(84827),C=i(60864),E=i(89202),j=i(22124),S=i(35464),D=i(40461);function _(e,t,i,n){const r=Math.min(e,t);let o=0,a=0;return e>r&&(o=(e-r)/2),t>r&&(a=(t-r)/2),[o,a,r,r,0,0,i,n]}var k=i(85893);function A(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function L(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?A(Object(i),!0).forEach((function(t){(0,w.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):A(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const Z=P.ZP.div.withConfig({displayName:"PreviewOverlay__Placeholder",componentId:"sc-1v9gcwf-0"})(["position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);min-height:100%;min-width:100%;width:100%;height:100%;object-fit:cover;background-color:",";border-radius:100px;"],(e=>e.theme.colors.overlayPlaceholderBg)),H=P.ZP.img.withConfig({displayName:"PreviewOverlay__Image",componentId:"sc-1v9gcwf-1"})(["position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);min-height:100%;min-width:100%;width:100%;height:100%;object-fit:cover;background-color:",";border-radius:100px;",";"],(e=>e.theme.colors.page),(e=>{let{$isFlipped:t}=e;return t&&(0,P.iv)(["transform:translate(-50%,-50%) scaleX(-1);"])})),M=P.ZP.canvas.withConfig({displayName:"PreviewOverlay__HiddenCanvas",componentId:"sc-1v9gcwf-2"})(["display:none;"]),z=P.ZP.video.withConfig({displayName:"PreviewOverlay__HiddenVideo",componentId:"sc-1v9gcwf-3"})(["display:none;"]);var N=e=>{let{enableVideo:t,enableRecording:i,tomeId:o,pageId:a,setCanPlay:l,setScaledUp:d,checkForMediaDevices:c}=e;const p=(0,O.Z)({tomeId:o}),{apolloClient:h,clientId:f}=(0,u.bp)(),m=(0,n.useRef)(null),y=(0,n.useRef)(null),v=(0,n.useRef)(0),[w,b]=(0,r.FV)((0,g.vw)(a)),P=(0,r.rb)((0,g.vw)(a)),A=(0,n.useCallback)((e=>{(0,s.XL)(o,a,e,h,f)}),[o,a,h,f]),N=(0,n.useCallback)((e=>{b((t=>L(L({},t),{},{progress:e})))}),[b]),U=(0,n.useCallback)((()=>{(0,s.Yt)(o,a,h,f)}),[o,a,h,f]),W=(0,n.useCallback)((()=>{(0,s.o1)(o,a,h,f),P(),(0,C.ak)({message:"Oops! Something went wrong"}),x.v.addError(new Error("Failed to upload overlay"),{tomeId:o,pageId:a})}),[o,a,h,f,P]),$=(0,n.useCallback)(((e,t)=>{const i=I()(),n=new File([e],i);b((e=>L(L({},e),{},{inProgress:!0}))),p(n,n.name,"",t,void 0,a,N,U,W,A)}),[b,p,a,N,U,W,A]),F=(0,n.useCallback)(((e,t)=>{const i=I()();b({uploadId:i,inProgress:!1,progress:0,localMediaUrl:e}),window.safari?t.arrayBuffer().then((e=>{const t=[{name:"inputVideo.mp4",data:e}],n=new Worker("/ffmpeg-worker-mp4.js",{name:"ffmpegjs"});n.onmessage=r=>{const o=r.data;switch(o.type){case"ready":n.postMessage({type:"run",MEMFS:t,arguments:["-i","inputVideo.mp4","-codec","copy","-bsf:v","h264_mp4toannexb","outputStream.mp4"]},[e]);break;case"stdout":case"stderr":console.log(o.data);break;case"done":{const e=o.data.MEMFS[0];if(e.data&&(e.data=e.data.buffer,"outputStream.mp4"===e.name&&n.postMessage({type:"run",MEMFS:o.data.MEMFS,arguments:["-r","30","-i","outputStream.mp4","-c","copy","outputVideo.mp4"]},[e.data]),"outputVideo.mp4"===e.name)){const t=new Blob([e.data]);$(t,i)}break}}}})):$(t,i)}),[b,$]),{startRecording:V,stopRecording:B,turnVideoOn:J,turnVideoOff:G,previewStream:Y,exportStream:q,checkPermissionsAndUpdateMediaDevices:K}=(0,T.L)({onStop:F}),X=(0,r.sJ)(D.fT),Q=(0,n.useRef)(null),{0:ee,1:te}=(0,n.useState)(null),{0:ie,1:ne}=(0,n.useState)(!1),{localMediaUrl:re}=w,oe=(0,n.useRef)(!1),ae=y.current,se=null===ae||void 0===ae?void 0:ae.getContext("2d"),le=(0,n.useCallback)((()=>{if(v.current=requestAnimationFrame(le),Y&&m.current&&ae&&se){const{videoWidth:t,videoHeight:i}=m.current,{width:n,height:r}=ae;se.clearRect(0,0,n,r);try{null===se||void 0===se||se.drawImage(m.current,..._(t,i,n,r))}catch(e){x.v.addError(e,{videoWidth:t,videoHeight:i,width:n,height:r,centeredDrawImageParameters:_(t,i,n,r)})}}}),[ae,se,Y]);(0,n.useEffect)((()=>{if(y.current&&m.current&&Q.current&&Y&&ae){var e;const t=null===(e=Y.getVideoTracks())||void 0===e?void 0:e[0];let i;if(t){const e=t.getSettings(),{width:n,height:r}=e,o=Math.min(n??1/0,r??1/0);ae.width=o,ae.height=o,e.frameRate&&(i=e.frameRate)}const n=ae.captureStream(i);n.addTrack(Y.getAudioTracks()[0]),Q.current.srcObject=n,q&&Y&&(q.current=n),m.current.srcObject=Y,m.current.play()}}),[ae,q,Y]),(0,n.useEffect)((()=>(Y&&(v.current=requestAnimationFrame(le)),()=>{cancelAnimationFrame(v.current)})),[le,Y]),(0,n.useEffect)((()=>{Q.current&&!Y&&(Q.current.srcObject=Y)}),[Y]),(0,n.useEffect)((()=>{c&&!oe.current&&(K(),oe.current=!0)}),[c,K]),(0,n.useEffect)((()=>(t&&J(),t||(G(),ne(!1)),()=>{G(),ne(!1)})),[t,J,G]);const de=(0,E.Z)(i);(0,n.useEffect)((()=>{i!==de&&(i&&Q.current?(te(null),J().then((()=>{V().then((()=>{Q.current&&(0,R.b)(Q.current).then((e=>{e&&te(URL.createObjectURL(e))}))}))}))):"recording"===X&&(B(),G(),ne(!1)))}),[i,X,B,G,J,V,de]),(0,n.useEffect)((()=>{l(!1),ne(!1),re||te(null)}),[l,re]);const ce=(0,n.useCallback)((()=>{l(!0),ne(!0)}),[l]),ue=(0,r._8)((e=>{let{snapshot:t,reset:i}=e;return()=>{const{inProgress:e,uploadId:n,progress:r}=t.getLoadable((0,g.vw)(a)).getValue();e&&x.v.addAction("Unmount while uploading overlay",{uploadVideo:{pageId:a,uploadId:n,progress:r}}),i((0,g.vw)(a))}}),[a]);return(0,n.useEffect)((()=>ue),[ue]),(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(j.U,{animate:{scale:"recording"===X&&ie?S.p3:1},onAnimationComplete:e=>{e.scale===S.p3?d(!0):d(!1)},children:[t&&(0,k.jsx)(Z,{}),ee&&(0,k.jsx)(H,{$isFlipped:!0,src:ee}),(0,k.jsx)(j.Y,{$isFlipped:!0,muted:!0,ref:Q,width:500,height:500,autoPlay:!0,onCanPlay:ce,$visible:ie})]}),(0,k.jsx)(M,{ref:y}),(0,k.jsx)(z,{muted:!0,playsInline:!0,ref:m})]})};const U=P.ZP.div.withConfig({displayName:"Countdown__CountdownWrapper",componentId:"sp2jf-0"})(["height:294px;width:294px;border-radius:100%;background-color:",";position:absolute;margin-left:auto;z-index:",";left:calc(50% - 147px);top:calc(50% - 147px);font-size:126px;font-weight:100;color:",";text-align:center;vertical-align:middle;line-height:294px;box-shadow:0px 100px 80px rgba(0,0,0,0.07),0px 41.7776px 33.4221px rgba(0,0,0,0.0503198),0px 22.3363px 17.869px rgba(0,0,0,0.0417275),0px 12.5216px 10.0172px rgba(0,0,0,0.035),0px 6.6501px 5.32008px rgba(0,0,0,0.0282725),0px 2.76726px 2.21381px rgba(0,0,0,0.0196802);"],(e=>{let{theme:t}=e;return t.colors.narrationCountdownBackground}),d.tF,(e=>{let{theme:t}=e;return t.colors.red}));var W=e=>{let{time:t,onCountdownComplete:i,onCountdown:r,initialDelay:o=.15,postDelay:a=.1}=e;const{0:s,1:l}=(0,n.useState)(t),d=(0,n.useRef)(s),c=(0,n.useRef)(),u=(0,n.useCallback)((()=>{r(d.current-1),l((e=>e-1))}),[r]);return(0,n.useEffect)((()=>(setTimeout((()=>{r(d.current),c.current=window.setInterval(u,1e3)}),1e3*o),()=>clearInterval(c.current))),[u,o,r]),(0,n.useEffect)((()=>{d.current=s,0===s&&(setTimeout((()=>i()),1e3*a),clearInterval(c.current))}),[s,i,a]),(0,k.jsxs)(U,{"data-testid":"countdown",children:[" ",Math.max(s,1)," "]})};var $=class{constructor(){(0,w.Z)(this,"audioCtx",void 0),(0,w.Z)(this,"soundBuffers",{}),(0,w.Z)(this,"soundBufferSources",{}),window.AudioContext=window.AudioContext||window.webkitAudioContext,this.audioCtx=new window.AudioContext}async prepareSoundBuffer(e){return new Promise(((t,i)=>{this.audioCtx.decodeAudioData(e,(e=>{t(e)}),(e=>{i(e)}))}))}async setupSound(e){const t=await fetch(e),i=await t.arrayBuffer(),n=await this.prepareSoundBuffer(i);this.soundBuffers[e]=n,this.prepareBufferSource(e)}playSound(e){var t;null===(t=this.soundBufferSources[e])||void 0===t||t.start(),this.prepareBufferSource(e)}teardown(){this.soundBuffers={},this.soundBufferSources={},this.audioCtx.close()}prepareBufferSource(e){const t=this.audioCtx.createBufferSource();t.buffer=this.soundBuffers[e],t.connect(this.audioCtx.destination),this.soundBufferSources[e]=t}};const F="/assets/countdown_1.mp3",V="/assets/countdown_2.mp3",B="/assets/countdown_3.mp3";var J=(0,n.forwardRef)(((e,t)=>{const i=(0,n.useRef)(null);return(0,n.useEffect)((()=>(i.current=new $,i.current.setupSound(F),i.current.setupSound(V),i.current.setupSound(B),()=>{var e;null===(e=i.current)||void 0===e||e.teardown()})),[]),(0,n.useImperativeHandle)(t,(()=>({playSoundOne:()=>{var e;null===(e=i.current)||void 0===e||e.playSound(F)},playSoundTwo:()=>{var e;null===(e=i.current)||void 0===e||e.playSound(V)},playSoundThree:()=>{var e;null===(e=i.current)||void 0===e||e.playSound(B)}}))),null})),G=i(13285);const Y=P.ZP.div.withConfig({displayName:"Overlaystyles__OverlayProgressWrapper",componentId:"sc-1u6i9bn-0"})(["position:absolute;top:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;"]),q=P.ZP.div.withConfig({displayName:"Overlaystyles__DragZone",componentId:"sc-1u6i9bn-1"})(["left:0;bottom:0;right:0;position:absolute;",""],(e=>e.inDrag&&(0,P.iv)(["z-index:",";"],d.Dl-1))),K=(0,P.ZP)(G.E.div).withConfig({displayName:"Overlaystyles__Dragger",componentId:"sc-1u6i9bn-2"})(["position:absolute;width:64px;height:64px;right:0;top:0;z-index:",";pointer-events:auto;display:",";&:hover{cursor:pointer;}"],d.Dl,(e=>e.$hide?"none":"inherit")),X=(0,P.ZP)(G.E.div).withConfig({displayName:"Overlaystyles__DragTarget",componentId:"sc-1u6i9bn-3"})(["position:absolute;width:","px;height:","px;border-radius:","px;background-color:",";opacity:0.4;z-index:",";"],(e=>e.size),(e=>e.size),(e=>e.size),(e=>e.theme.colors.contentAccent),d.Dl),Q=(0,P.ZP)(X).withConfig({displayName:"Overlaystyles__TargetUL",componentId:"sc-1u6i9bn-4"})(["top:0;left:0;"]),ee=(0,P.ZP)(X).withConfig({displayName:"Overlaystyles__TargetUR",componentId:"sc-1u6i9bn-5"})(["top:0;right:0;"]),te=((0,P.ZP)(X).withConfig({displayName:"Overlaystyles__TargetBR",componentId:"sc-1u6i9bn-6"})(["bottom:0;right:0;"]),(0,P.ZP)(X).withConfig({displayName:"Overlaystyles__TargetBL",componentId:"sc-1u6i9bn-7"})(["bottom:0;left:0;"]),(0,P.ZP)(G.E.div).withConfig({displayName:"Overlaystyles__OverlayContainer",componentId:"sc-1u6i9bn-8"})(["position:absolute;top:0;right:0;width:64px;height:64px;background-color:transparent;z-index:",";display:",";"],d.Dl,(e=>e.$hide?"none":"inherit"))),ie=(0,P.ZP)(G.E.div).withConfig({displayName:"Overlaystyles__VisibilityContainer",componentId:"sc-1u6i9bn-9"})(["visibility:",";position:absolute;"],(e=>e.$visibility?"visible":"hidden")),ne=P.ZP.div.withConfig({displayName:"Overlaystyles__CountdownScrim",componentId:"sc-1u6i9bn-10"})(["z-index:1;position:absolute;background-color:",";width:100%;height:100%;display:flex;align-items:center;justify-content:center;"],(e=>e.theme.colors.countdownScrim)),re=P.ZP.div.withConfig({displayName:"Overlaystyles__OverlayLayer",componentId:"sc-1u6i9bn-11"})(["position:",";left:0;right:0;bottom:0;z-index:999;pointer-events:none;"],(e=>e.$isMobile?"sticky":"absolute")),oe=P.ZP.div.withConfig({displayName:"Overlaystyles__StickyWrapper",componentId:"sc-1u6i9bn-12"})(["position:sticky;top:0;height:76px;overflow:visible;pointer-events:none;"]),ae=(e,t)=>[-e+t+12,-12,12];var se;!function(e){e.DEFAULT="default",e.HIDDEN="hidden",e.DRAGGING="dragging",e.CLICKED="clicked"}(se||(se={}));const le=e=>{let{overlayData:t,pageId:i,tomeId:w,canEdit:b,display:I,pageHeight:P,pageWidth:x,isMobile:T,playMode:O}=e;const R=(0,r.sJ)(D.wo),{apolloClient:C,clientId:E}=(0,u.bp)(),j=(0,r.sJ)((0,g.vw)(i)),_=(0,r.rb)((0,g.vw)(i)),{localMediaUrl:A}=j,L=(0,m.f3)()===f.Z.RECORD,Z=L||R,H=(0,n.useRef)(null),M=!!A||t.videoStatus===c.Kwn.Ready,{0:z,1:U}=(0,n.useState)(!1),{0:$,1:F}=(0,n.useState)(!1),{0:V,1:B}=(0,n.useState)(!1),{0:G,1:X}=(0,n.useState)(!1),{0:le,1:de}=(0,n.useState)(!1),ce=(0,n.useRef)(),ue=!Z&&!M,{0:pe,1:ge}=(0,n.useState)(se.DEFAULT),{0:he,1:fe}=(0,n.useState)(!1),me=(0,n.useRef)(!1),ye=(0,o._)(),ve=(0,n.useRef)(null),we=(0,a.c)(0),be=(0,a.c)(0),{0:Ie,1:Pe}=(0,n.useState)(t.position||c._zJ.UpperRight),xe=j.inProgress;(0,n.useEffect)((()=>{t.position&&Pe(t.position)}),[t.position]),(0,n.useEffect)((()=>{I&&pe===se.HIDDEN&&ge(se.DEFAULT),I||ge(se.HIDDEN)}),[I,pe]);const Te=(0,n.useCallback)((()=>{if(ve.current&&t.position){const e=ae(x,64),[i,n]=((e,t)=>{const[,i]=e.toString().split("_"),n=t[2];let r;return r="LEFT"===i?t[0]:t[1],[r,n]})(t.position,e);we.set(i),be.set(n)}}),[t.position,x,64,we,be]);(0,n.useEffect)((()=>{Te()}),[Te]),(0,n.useEffect)((()=>{R&&z?(de(!1),X(!0)):R||(de(!1),X(!1))}),[R,z]),(0,n.useEffect)((()=>{var e,t;R&&(null!==(e=H.current)&&void 0!==e&&e.isPlaying()&&(null===(t=H.current)||void 0===t||t.toggleVideo()))}),[R]),(0,n.useEffect)((()=>{t.videoStatus===c.Kwn.Ready&&_()}),[t.videoStatus,_]);const Oe=(0,n.useCallback)(((e,t)=>{if(ge(se.DEFAULT),ve.current){const[e,n,r]=ae(x,64),o=e/2,a=1500;let l,d;we.get()<o?(l=e,d="LEFT",t.velocity.x>a&&(l=n,d="RIGHT")):(l=n,d="RIGHT",t.velocity.x<-a&&(l=e,d="LEFT"));const c=r,u=`${"UPPER"}_${d}`;u!==Ie&&(Pe(u),b&&!T&&(0,s.I2)(w,i,C,E,u)),ye.start({x:l,y:c,transition:{duration:.1}}).then((()=>{fe(!1),me.current=!1})),setTimeout((()=>ge(se.DEFAULT)),240)}}),[C,b,E,Ie,we,ye,T,i,x,w]),Re=(0,n.useCallback)((()=>{_(),(0,s.Np)(w,i,C,E)}),[C,E,i,_,w]),Ce=(0,n.useCallback)((e=>{var t,i,n;switch(e){case 3:null===(t=ce.current)||void 0===t||t.playSoundOne();break;case 2:null===(i=ce.current)||void 0===i||i.playSoundTwo();break;case 1:null===(n=ce.current)||void 0===n||n.playSoundThree()}}),[]),Ee=(0,n.useCallback)((()=>{de(!0),X(!1)}),[]);return(0,k.jsxs)(k.Fragment,{children:[G&&(0,k.jsx)(l.Z,{top:0,left:0,zIndex:d.y$,fullscreen:!0,children:(0,k.jsx)(ne,{children:(0,k.jsx)(W,{time:3,onCountdownComplete:Ee,onCountdown:Ce})})}),Z&&(0,k.jsx)(J,{ref:ce}),(0,k.jsx)(q,{inDrag:he,"data-tome-bypass-tap-navigation":"Overlay__DragZone",style:{height:T?0:P,width:T?0:x,top:"calc(var(--mobile-header-top-padding, 0px))"},children:(0,k.jsxs)(oe,{ref:ve,style:{top:"calc(var(--mobile-header-top-padding, 0px))",width:x},children:[(0,k.jsx)(Q,{size:64,animate:pe,variants:S.$S,initial:se.DEFAULT}),(0,k.jsx)(ee,{size:64,animate:pe,variants:S.$S,initial:se.DEFAULT})]})}),(0,k.jsx)(re,{"data-tome-bypass-tap-navigation":"Overlay__OverlayLayer",$isMobile:T,style:{height:T?0:P,width:T?0:x,top:"calc(var(--mobile-header-top-padding, 0px))",transition:"top 0.2s ease-in-out"},children:(0,k.jsx)(oe,{style:{width:x},children:(0,k.jsxs)(te,{style:{x:we,y:be},variants:S.IR,animate:pe,$hide:ue,children:[(0,k.jsx)(ie,{$visibility:!V,children:(0,k.jsx)(N,{pageId:i,tomeId:w,enableVideo:(!M||R)&&Z,checkForMediaDevices:L,enableRecording:R&&le,setCanPlay:U,setScaledUp:F})}),(0,k.jsx)(v.Z,{shouldAnimateIn:T||O,shouldBeVisible:M&&!z&&!$,ref:H,localMediaUrl:A,overlayData:t,setPlaybackPlaying:B,isInRecordMode:Z,isMobile:T,tomeId:w}),xe&&(0,k.jsx)(Y,{"data-testid":"overlay_progress",children:(0,k.jsx)(h.Z,{width:24,height:24,progress:j.progress,infinite:1===j.progress})},"progressIndicator")]})})}),(0,k.jsxs)(re,{"data-tome-bypass-tap-navigation":"Overlay__OverlayLayer","data-testid":"av_overlay_layer",$isMobile:T,style:{height:T?0:P,width:T?0:x,top:"calc(var(--mobile-header-top-padding, 0px))"},children:[(0,k.jsx)(oe,{style:{width:x},onMouseDown:e=>{e.stopPropagation()},children:(0,k.jsx)(p.Z,{menuWidth:140,menuPosition:"below",menuAlign:"click",rightClickActivated:!0,disabled:!b,itemsOrFn:[{text:"Delete",action:Re,variant:"destructive"}],children:(0,k.jsx)(K,{"data-testid":"av_overlay_dragger",$hide:ue,drag:(b||T)&&!R,dragConstraints:ve,animate:ye,style:{x:we,y:be},onDrag:()=>{var e;ge(se.DRAGGING),null===(e=document.querySelector(".ProseMirror-focused"))||void 0===e||e.blur()},onDragStart:()=>{fe(!0),me.current=!0},onDragEnd:Oe,onTap:()=>{xe||(R||!H.current||me.current||H.current.toggleVideo(),ge(se.DEFAULT))},onMouseDown:()=>{ge(se.CLICKED)}})})}),pe===se.DRAGGING&&(0,k.jsx)(y.Z,{})]})]})};var de=e=>{let{overlayData:t,pageId:i,tomeId:n,canEdit:r,display:o,pageHeight:a,pageWidth:s,isMobile:l,playMode:d}=e;return t?(0,k.jsx)(le,{overlayData:t,pageId:i,canEdit:r,tomeId:n,display:o,pageHeight:Number.isNaN(a)?0:a,pageWidth:Number.isNaN(s)?0:s,isMobile:l,playMode:d}):null}},35464:function(e,t,i){i.d(t,{$S:function(){return n},DO:function(){return a},IR:function(){return r},p3:function(){return o}});const n={default:{scale:0,opacity:0,transition:{opacity:{duration:.35,ease:[.4,0,.1,1],delay:.25},scale:{type:"spring",stiffness:550,damping:30,delay:.25}}},dragging:{scale:.5,opacity:.75,transition:{opacity:{duration:.5,ease:[.4,0,.1,1],delay:.3},scale:{type:"spring",stiffness:550,damping:30,delay:.3}}}},r={default:{scale:1,opacity:1,transition:{opacity:{duration:.3,ease:[.4,0,.1,1],delay:.3}}},clicked:{scale:.95,opacity:1},dragging:{scale:1.1,opacity:1},hidden:{opacity:0,transition:{opacity:{duration:.1,ease:[.4,0,.1,1]}}}},o=1.5,a=1.15},22124:function(e,t,i){i.d(t,{U:function(){return o},Y:function(){return a}});var n=i(59016),r=i(13285);const o=(0,n.ZP)(r.E.div).withConfig({displayName:"OverlayVideo__VideoWrapper",componentId:"sc-1xfsogz-0"})(["position:relative;display:flex;align-items:center;justify-content:center;width:",";height:",";background-color:transparent;filter:drop-shadow(0px 6px 16px rgba(0,0,0,0.25));border-radius:50%;overflow:hidden;",";"],(e=>{let{$useSmallSize:t}=e;return t?"48px":"64px"}),(e=>{let{$useSmallSize:t}=e;return t?"48px":"64px"}),(e=>{let{$hasBorder:t}=e;return t&&(0,n.iv)(["::after{content:' ';position:absolute;left:0;right:0;top:0;bottom:0;border-radius:50%;border:1px solid rgba(255,255,255,0.12);pointer-events:none;}"])})),a=n.ZP.video.withConfig({displayName:"OverlayVideo__VideoPlayer",componentId:"sc-1xfsogz-1"})(["position:absolute;top:50%;left:50%;min-height:100%;min-width:100%;width:100%;height:100%;object-fit:cover;visibility:",";",";"],(e=>{let{$visible:t}=e;return t?"inherited":"hidden"}),(e=>{let{$isFlipped:t}=e;return t&&(0,n.iv)(["transform:translate(-50%,-50%) scaleX(-1);"])}))},41100:function(e,t,i){i.d(t,{f:function(){return S},Z:function(){return k}});var n=i(59499),r=i(67294),o=i(67631),a=i.n(o),s=i(95421),l=i(13285),d=i(4480),c=i(51718),u=i(22124),p=i(35464),g=i(59016),h=i(85518),f=i(19148),m=i(17009),y=i(60864),v=i(24306),w=i(85893);function b(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function I(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?b(Object(i),!0).forEach((function(t){(0,n.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):b(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var P=(0,r.forwardRef)(((e,t)=>(0,w.jsxs)(v.Z,I(I({ref:t,viewBox:"0 0 64 64"},e),{},{children:[(0,w.jsx)(l.E.path,{d:"M7.00164 23.0283C5.3444 23.0279 4.00057 24.3711 4 26.0283L4.00001 38.03C4.00045 39.6873 5.34425 41.0304 7.00151 41.03H12.5089C13.5698 41.0299 14.5873 41.451 15.3379 42.2006L23.5817 50.4356C23.9569 50.8103 24.4654 51.0209 24.9957 51.0212C26.1015 51.0217 26.9984 50.1258 26.9989 49.02V15.03C26.9986 14.5001 26.7882 13.9918 26.4137 13.6168C25.6326 12.8347 24.3654 12.8339 23.5832 13.6149L15.331 21.8576C14.5805 22.6073 13.5631 23.0284 12.5022 23.0283H7.00164Z",fill:"currentColor"}),(0,w.jsx)(l.E.path,{fill:"currentColor",d:"M30.5893 17.7952C31.1051 16.5742 32.5131 16.0026 33.7341 16.5185C39.7623 19.0654 44 25.0349 44 31.9998C44 38.9646 39.7623 44.9342 33.7341 47.4811C32.5131 47.997 31.1051 47.4254 30.5893 46.2044C30.0734 44.9834 30.645 43.5754 31.866 43.0595C36.18 41.2368 39.2 36.9682 39.2 31.9998C39.2 27.0313 36.18 22.7627 31.866 20.94C30.645 20.4241 30.0734 19.0161 30.5893 17.7952Z",animate:{opacity:[0,1,1,0]},transition:{times:[.19,.2,.4,.41],duration:3,repeat:1/0,type:"linear"}}),(0,w.jsx)(l.E.path,{fill:"currentColor",d:"M38.0314 12.2418C38.7897 11.1546 40.2857 10.8881 41.3729 11.6464C47.7919 16.1238 51.9998 23.5702 51.9998 31.9998C51.9998 40.4294 47.7919 47.8758 41.3729 52.3532C40.2857 53.1116 38.7897 52.845 38.0314 51.7578C37.2731 50.6707 37.5396 49.1747 38.6268 48.4164C43.814 44.7981 47.1998 38.7942 47.1998 31.9998C47.1998 25.2054 43.814 19.2015 38.6268 15.5833C37.5396 14.8249 37.2731 13.3289 38.0314 12.2418Z",animate:{opacity:[0,1,1,0]},transition:{times:[.39,.4,.6,.61],duration:3,repeat:1/0,type:"linear"}}),(0,w.jsx)(l.E.path,{fill:"currentColor",d:"M45.0151 7.2481C45.8721 6.23699 47.3866 6.11211 48.3977 6.96918C55.4913 12.982 60 21.9657 60 32C60 42.0342 55.4913 51.0179 48.3977 57.0307C47.3866 57.8878 45.8721 57.7629 45.0151 56.7518C44.158 55.7407 44.2829 54.2262 45.294 53.3692C51.3576 48.2294 55.2 40.5646 55.2 32C55.2 23.4353 51.3576 15.7705 45.294 10.6307C44.2829 9.77366 44.158 8.25921 45.0151 7.2481Z",animate:{opacity:[0,1,1,0]},transition:{times:[.59,.6,.8,.81],duration:3,repeat:1/0,type:"linear"}})]}))));function x(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function T(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?x(Object(i),!0).forEach((function(t){(0,n.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):x(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const O=(0,g.ZP)(l.E.div).withConfig({displayName:"OverlayTooltip__PositionedContainer",componentId:"rx1vxm-0"})(["position:relative;"]);var R=e=>{let{videoWrapperRef:t,showTooltip:i,position:n,tooltipCopy:o=f.ZP.t("overlay.overlayTooltip.tooltipCopy"),shouldScale:a=!0}=e;const s=(0,g.Fg)(),l=(0,r.useRef)(null),{0:d,1:u}=(0,r.useState)({top:0,left:0});(0,r.useEffect)((()=>{var e,i;const r=null===(e=l.current)||void 0===e?void 0:e.getBoundingClientRect(),o=null===(i=t.current)||void 0===i?void 0:i.getBoundingClientRect();if(o&&r){const e=h.tq||!a?1:(0,y.k6)(),t=(-o.height/2-r.height/2)/e;let i=0;switch(n){case c._zJ.UpperRight:i=-r.width/e-10;break;case c._zJ.UpperLeft:i=o.width/e+10;case c._zJ.BottomRight:case c._zJ.BottomLeft:}u({top:t,left:i})}}),[n,t,a]);let p=10;switch(n){case c._zJ.UpperRight:case c._zJ.BottomRight:p=-10}return(0,w.jsx)(O,{initial:{opacity:0},animate:{opacity:i?1:0,scale:i?1:.9},transition:{type:"tween",duration:.5},style:T({},d),children:(0,w.jsx)(m.DY,{animate:{x:[p,0,p]},transition:{repeat:1/0,type:"spring",duration:3,delay:.55},children:(0,w.jsxs)(m._v,{ref:l,$background:s.colors.tooltipOnSheetBg,children:[o,(0,w.jsx)(P,{style:{width:14,height:14,verticalAlign:"bottom",margin:"0 2"}})]})})})},C=i(40461);function E(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function j(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?E(Object(i),!0).forEach((function(t){(0,n.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):E(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}let S;var D;!function(e){e[e.NORMAL=0]="NORMAL",e[e.SMALL=1]="SMALL"}(S||(S={})),function(e){e[e.STOPPED=0]="STOPPED",e[e.PLAYING=1]="PLAYING",e[e.PAUSED=2]="PAUSED"}(D||(D={}));const _={initialWithBounce:{scale:0},withBounce:{scale:1,transition:{type:"spring",bounce:.5}},initialWithOutBounce:{scale:1},withoutBounce:{scale:1}};var k=(0,r.forwardRef)(((e,t)=>{let{overlayData:i,setPlaybackPlaying:n,isInRecordMode:o,isMobile:g,localMediaUrl:h,shouldBeVisible:f,shouldAnimateIn:m,videoProps:y,tooltipCopy:v,shouldScaleTooltip:b,size:I=S.NORMAL,tomeId:P,forceLoad:x=!1}=e;const{videoUrl:T,videoThumbnailUrl:O,videoStatus:E}=i,k=!!h,A=E===c.Kwn.Ready,L=k&&h?h:T||void 0,Z=k?"":O||void 0,H=(0,r.useRef)(null),M=(0,r.useRef)(null),{0:z,1:N}=(0,r.useState)(D.STOPPED),{0:U,1:W}=(0,r.useState)(!1),{0:$,1:F}=(0,r.useState)(!1),V=(0,r.useRef)(void 0),[B,J]=(0,d.FV)((0,C.K3)(P));(0,r.useEffect)((()=>{N(D.STOPPED)}),[L]),(0,r.useEffect)((()=>{if(Z&&m){const e=new Image;W(!0),e.src=Z,e.onload=()=>{W(!1)}}}),[m,Z]),(0,r.useEffect)((()=>{const e=M.current;if(!k&&A&&e&&L&&!L.includes(".mp4")&&a().isSupported()){const t=new(a());t.on(a().Events.MEDIA_ATTACHED,(()=>{t.loadSource(L)})),t.attachMedia(e)}}),[L,k,A]),(0,r.useEffect)((()=>{var e;x&&(null===(e=M.current)||void 0===e||e.load())}),[L,x]);const G=(0,r.useCallback)((()=>{F(!1),M.current&&(z!==D.PLAYING?V.current=M.current.play():void 0!==V.current&&V.current.then((()=>{var e;return null===(e=M.current)||void 0===e?void 0:e.pause()})))}),[z]),Y=(0,r.useCallback)((e=>{M.current&&(M.current.currentTime=e)}),[]),q=(0,r.useCallback)((()=>{if(M.current)return M.current.currentTime}),[]),K=(0,r.useCallback)((()=>z===D.PLAYING),[z]);(0,r.useImperativeHandle)(t,(()=>({toggleVideo:G,isPlaying:K,setCurrentTime:Y,currentTime:q})));const X=g?p.DO:p.p3,Q={playback:{scale:z===D.PLAYING?X:1}},ee=(0,r.useCallback)((()=>{N(D.PLAYING),n(!0),J(!0)}),[J,n]),te=(0,r.useCallback)((()=>{N(D.PAUSED),n(!1)}),[n]),ie=(0,r.useCallback)((()=>{N(D.STOPPED),n(!1)}),[n]);(0,r.useEffect)((()=>{m||F(!1)}),[m]);let ne="withoutBounce";return m&&(ne=U?"initialWithBounce":"withBounce"),(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(s.M,{children:f&&(0,w.jsx)(l.E.div,{initial:m?"initialWithBounce":"initialWithoutBounce",animate:ne,onAnimationComplete:e=>{m&&!o&&"withBounce"===e&&F(!0)},variants:_,children:(0,w.jsx)(u.U,{animate:["playback"],variants:Q,style:{translateZ:"0"},ref:H,$useSmallSize:I===S.SMALL,$hasBorder:!0,children:(k||A)&&(0,w.jsx)(u.Y,j({controls:!1,ref:M,src:L,playsInline:!0,$isFlipped:!0,$visible:!0,onPlay:ee,onPause:te,onEnded:ie,poster:Z,"data-isavoverlay":"true","data-testid":(A?"remote":"local")+"_overlay_video"},y))})},"playbackOverlay")}),$&&!B&&(0,w.jsx)(R,{tooltipCopy:v,showTooltip:$,videoWrapperRef:H,position:i.position??c._zJ.UpperRight,shouldScale:b})]})}))},40461:function(e,t,i){i.d(t,{$6:function(){return o},HV:function(){return s},K3:function(){return u},LW:function(){return l},ep:function(){return d},fT:function(){return c},jd:function(){return r},wo:function(){return a}});var n=i(4480);const r=(0,n.cn)({key:"audioDevicesState",default:[]}),o=(0,n.cn)({key:"videoDevicesState",default:[]}),a=(0,n.cn)({key:"desiredRecordingStateState",default:!1}),s=(0,n.cn)({key:"videoDeviceIdState",default:null}),l=(0,n.cn)({key:"audioDeviceIdState",default:null}),d=(0,n.cn)({key:"overlayRecordingErrorsState",default:"NONE"}),c=(0,n.cn)({key:"overlayStatusState",default:"idle"}),u=(0,n.xu)({key:"hasAnOverlayBeenPlayedState",default:!1})},92627:function(e,t,i){i.d(t,{e:function(){return a}});var n=i(67294),r=i(85893);const o=n.createContext({}),a=e=>{let{children:t}=e;const i=(0,n.useRef)(null),a=(0,n.useRef)(null),s=(0,n.useRef)(null),l=(0,n.useCallback)((e=>{const t=i.current===e;e&&!t&&(i.current=e,e.scrollTop=0,s.current&&s.current(),a.current=null,s.current=null)}),[]),d=(0,n.useCallback)((e=>{a.current=e}),[]),c=(0,n.useCallback)((e=>{s.current=e}),[]);return(0,r.jsx)(o.Provider,{value:{scrollingPageRef:i,setScrollingPageRef:l,pageScrollTopAnimatedToRef:a,setPageScrollTopAnimatedToRef:d,pageScrollAnimationStopRef:s,setPageScrollAnimationStopRef:c},children:t})};t.Z=o},39626:function(e,t,i){let n;function r(e){let{widthToBeSquishedInUnits:t,deltaInUnits:i,numSquishedTiles:n,totalUnitsAvailable:r}=e,o=!1;const a=t-i;let s;return a<n?(o=!0,s=n):s=Math.round(a),{sideInUnits:s,otherSideInUnits:r-s,reachedMinimum:o}}function o(e){let{numOfLeftTilesToAdj:t,numOfRightTilesToAdj:i,leftWidthInUnitsPreResize:n,rightWidthInUnitsPreResize:o,deltaInUnits:a}=e;const s=n+o;let l,d,c;a<0?(c=r({widthToBeSquishedInUnits:n,deltaInUnits:-a,numSquishedTiles:t,totalUnitsAvailable:s}),l=c.sideInUnits,d=c.otherSideInUnits):(c=r({widthToBeSquishedInUnits:o,deltaInUnits:a,numSquishedTiles:i,totalUnitsAvailable:s}),d=c.sideInUnits,l=c.otherSideInUnits);return{leftTileWidthInUnits:l/t,rightTileWidthInUnits:d/i,reachedMinimum:c.reachedMinimum}}function a(e){let{leftWidthInUnitsPreResize:t,rightWidthInUnitsPreResize:i,numOfLeftTilesToAdj:n,numOfRightTilesToAdj:r,deltaPx:o}=e;return o<0&&t<=n||o>0&&i<=r}i.d(t,{e9:function(){return o},jm:function(){return a},yV:function(){return n}}),function(e){e.NOOP="noop",e.REACHED_MINIMUM="reached_minimum",e.SUCCESS="success"}(n||(n={}))},27453:function(e,t,i){i.d(t,{Z:function(){return h}});var n=i(67294),r=i(24656),o=i(24418),a=i(40556),s=i(59499);var l=i(67156),d=i(20543),c=i(18036),u=i(90370),p=i(39626);var g=class{constructor(e,t,i,n,r,o){(0,s.Z)(this,"frontendPageLayout",void 0),(0,s.Z)(this,"persistLayout",void 0),(0,s.Z)(this,"tileRefs",void 0),(0,s.Z)(this,"rowHeights",void 0),(0,s.Z)(this,"tileWidths",void 0),(0,s.Z)(this,"triggerRender",void 0),(0,s.Z)(this,"pixelsPerHeightUnit",void 0),(0,s.Z)(this,"rowHeightPreResize",void 0),(0,s.Z)(this,"rowPadding",void 0),this.frontendPageLayout=d.Z.fromLayout(e,t),this.persistLayout=i,this.tileRefs=new Map,this.pixelsPerHeightUnit=n,this.rowPadding=r,this.triggerRender=o,this.rowHeights=new Map,this.tileWidths=new Map,this.updateActualHeights(),this.updateAllTileWidths(),this.rowHeightPreResize=void 0}update(e,t,i,n,r){const o=d.Z.fromLayout(e,t);this.persistLayout=i,this.pixelsPerHeightUnit=n,this.rowPadding=r,o.isEquivalentTo(this.frontendPageLayout)||(this.frontendPageLayout=o,this.rowHeights.clear(),this.tileWidths.clear(),this.updateActualHeights(),this.updateAllTileWidths())}isSingleTile(e){return this.frontendPageLayout.isSingleTile(e)}getRowHeight(e){return this.rowHeights.get(e)}getTileHeightInPx(e){const t=this.rowHeights.get(e);return void 0===t?t:t*this.pixelsPerHeightUnit-this.rowPadding}triggerLayoutRecalculationAndRender(){this.updateActualHeights(),this.triggerRender()}findNoopDropzones(e){return this.frontendPageLayout.findNoopDropzones(e)}tileRefCallback(e){return t=>{null!==t?this.tileRefs.set(e,t):this.tileRefs.delete(e)}}sumOfRowHeightsInUnits(){return Array.from(this.rowHeights.values()).reduce(((e,t)=>e+t),0)}getTilePosition(e,t,i){const n=this.frontendPageLayout.rowByTileId(e);if(void 0===n)throw new Error(`Row not found for tile ${e}`);let r=0;for(const l of this.frontendPageLayout.rows){if(n.id===l.id)break;r+=this.getRowHeight(l.id)}let o=0;for(const l of n.tiles){if(l.tileId===e)break;o+=this.getTileWidthInPx(l.tileId,t,i)??0}const a=r*this.pixelsPerHeightUnit+i,s=this.getTileWidthInPx(e,t,i)??0;return{top:a,left:o+i*(n.tiles.findIndex((t=>t.tileId===e))+1),width:s,height:this.getRowHeight(n.id)*this.pixelsPerHeightUnit-i}}getTileRowId(e){var t;return null===(t=this.frontendPageLayout.rowByTileId(e))||void 0===t?void 0:t.id}addTileToNewRow(e,t,i){const n=this.frontendPageLayout.addTileToNewRow(e,{kind:c.DV.NEW_TILE},t,i,this.getRowHeight.bind(this));return this.updateRowHeightsAndTileWidthsAfterLayoutChange(),n}addTileToExistingRow(e,t,i,n,r){const o=this.frontendPageLayout.addTileToExistingRow(e,t,i,n,r,this.getRowHeight.bind(this));return this.updateRowHeightsAndTileWidthsAfterLayoutChange(),o}addTileToEndOfPage(e,t,i){const n=this.frontendPageLayout.addTileToEndOfPage(e,t,i,this.getRowHeight.bind(this));return this.updateRowHeightsAndTileWidthsAfterLayoutChange(),n}deleteTile(e){this.frontendPageLayout.deleteTile(e,this.getRowHeight.bind(this)),this.updateRowHeightsAndTileWidthsAfterLayoutChange()}moveTile(e,t){this.conditionallyUpdateAndPersistLayout((i=>(i.moveTile(e,t,this.getRowHeight.bind(this)),!0)))}getRowResizeHandlers(e){return{handleResizeStart:()=>{this.rowHeightPreResize=this.getRowHeight(e)},handleResize:t=>{const i=function(e,t,i){const n=t+Math.round(e);return Math.max(n,i)}(t/this.pixelsPerHeightUnit,this.rowHeightPreResize,this.getRowMinimumHeight(e));this.rowHeights.get(e)!==i&&(this.rowHeights.set(e,i),this.updateActualHeights(e),this.triggerRender())},handleResizeComplete:()=>{const t=this.getRowHeight(e),i=this.frontendPageLayout.getTileTypesForRow(e).map((e=>(0,u.g)(e))).every((e=>e===u.Y.FIXED));let n;n=t===this.getRowMinimumHeight(e)&&i?null:t/l.Cj,this.updateRowHeight(e,n),this.rowHeightPreResize=void 0}}}sumTileWidthsInUnits(e){let{row:t,start:i,end:n}=e;return t.tiles.slice(i,n).reduce(((e,t)=>e+(this.tileWidths.get(t.tileId)??0)),0)*l.w4}getTileResizeHandlers(e,t,i){var n=this;let r,o,a,s,d=!1;return{handleResizeStart:function(){let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];d=i;const l=n.frontendPageLayout.rowById(t);l&&(r=n.sumTileWidthsInUnits({row:l,start:d?e-1:0,end:e}),o=n.sumTileWidthsInUnits({row:l,start:e,end:d?e+1:void 0}),a=d?1:e,s=d?1:l.numTiles()-e)},handleResize:n=>{const c=this.frontendPageLayout.rowById(t);if(!c)return p.yV.NOOP;if(0===n)return p.yV.NOOP;if((0,p.jm)({numOfLeftTilesToAdj:a,numOfRightTilesToAdj:s,leftWidthInUnitsPreResize:r,rightWidthInUnitsPreResize:o,deltaPx:n}))return p.yV.REACHED_MINIMUM;const u=n/i*l.w4,g=(0,p.e9)({numOfLeftTilesToAdj:a,numOfRightTilesToAdj:s,leftWidthInUnitsPreResize:r,rightWidthInUnitsPreResize:o,deltaInUnits:u}),h=g.leftTileWidthInUnits/l.w4,f=g.rightTileWidthInUnits/l.w4,m=d?c.tiles.slice(e-1,e+1):c.tiles,y=d?1:e;return m.forEach(((e,t)=>{t<y?this.tileWidths.set(e.tileId,h):this.tileWidths.set(e.tileId,f)})),this.triggerRender(),g.reachedMinimum?p.yV.REACHED_MINIMUM:p.yV.SUCCESS},handleResizeComplete:()=>{const e=this.frontendPageLayout.rowById(t);if(!e)return;const i=new Map;e.tiles.forEach((e=>{i.set(e.tileId,this.tileWidths.get(e.tileId))})),this.updateTileWidths(t,i)}}}distributeWidths(e){const t=this.frontendPageLayout.rowById(e);if(!t)return;const i=t.getDistributedRelativeWidth(),n=new Map;t.tiles.forEach((e=>{this.tileWidths.set(e.tileId,i),n.set(e.tileId,i)})),this.triggerRender(),this.updateTileWidths(e,n)}alreadyEvenlyDistributed(e){const t=this.frontendPageLayout.rowById(e);if(!t)return!0;const i=t.getDistributedRelativeWidth();return t.tiles.every((e=>e.relativeWidth===i))}tileNeighborByDirection(e,t,i){return this.frontendPageLayout.tileNeighborByDirection(e,t,i)}getTileWidthInPx(e,t,i){if(void 0===this.frontendPageLayout.rowByTileId(e))return;return(t-i)*this.tileWidths.get(e)-i}getTileWidthInUnits(e){if(!this.frontendPageLayout.rowByTileId(e))return;return this.tileWidths.get(e)*l.w4}getTileWidthPercentage(e){const t=this.frontendPageLayout.rowByTileId(e);if(void 0===t)throw new Error(`Row not found for tile ${e}`);const i=t.tileById(e);if(void 0===i)throw new Error(`Tile not found in row ${t.id}`);return i.relativeWidth/t.relativeWidthSum()}getLastRowHeightIfLastRow(e){if(this.frontendPageLayout.lastRow.id===e)return this.lastRowHeight()}getRowMinimumHeight(e){return(0,c.nA)(this.getHeightsForRowFromTiles(this.frontendPageLayout.rowById(e)),this.getLastRowHeightIfLastRow(e))}updateRowHeight(e,t){this.conditionallyUpdateAndPersistLayout((i=>{const n=i.rowById(e);return!!n&&(n.row.relativeHeight=t,!0)}))}updateTileWidths(e,t){this.conditionallyUpdateAndPersistLayout((i=>{const n=i.rowById(e);return!!n&&(t.forEach(((e,t)=>{const i=n.tileById(t);i&&(i.relativeWidth=e)})),!0)}))}lastRowHeight(e){const t=e??this.rowHeights;let i=0;const n=this.frontendPageLayout.rows.map((e=>e.id));for(const[r,o]of t)n.includes(r)&&r!==this.frontendPageLayout.lastRow.id&&(i+=o);return l.Cj-i}getHeightsForRowFromTiles(e){const t=e.tiles.map((e=>e.tileId)),i=new Map([...this.tileRefs].filter((e=>{let[i]=e;return t.includes(i)})));return Array.from(i.values(),(e=>e.getHeight().addPixelsIfAppropriate(this.rowPadding).toUnits(this.pixelsPerHeightUnit)))}updateActualHeights(e){this.frontendPageLayout.rows.forEach((t=>{if(t.id===e)return;const i=(0,c.tn)(t.row.relativeHeight,this.getHeightsForRowFromTiles(t),this.getLastRowHeightIfLastRow(t.id));this.rowHeights.set(t.id,i)}))}updateAllTileWidths(){this.frontendPageLayout.rows.forEach((e=>{this.updateTileWidthsForRow(e.id)}))}updateTileWidthsForRow(e){const t=this.frontendPageLayout.rowById(e);if(void 0===t)throw new Error(`Row not found for row ${e}`);t.tiles.forEach((e=>{const t=this.getTileWidthPercentage(e.tileId);this.tileWidths.set(e.tileId,t)}))}setLastRowRelativeHeightIfNeeded(){const e=this.frontendPageLayout.lastRow;return!this.frontendPageLayout.getTileTypesForRow(e.id).map((e=>(0,u.g)(e))).every((e=>e===u.Y.FIXED))&&(!((e.row.relativeHeight??0)*l.Cj>=this.lastRowHeight())&&(e.row.relativeHeight=this.rowHeights.get(e.id)/l.Cj,!0))}conditionallyUpdateAndPersistLayout(e){const t=d.Z.copyFrom(this.frontendPageLayout);e(t)&&(this.frontendPageLayout.isEquivalentTo(t)||(this.frontendPageLayout=t,this.updateRowHeightsAndTileWidthsAfterLayoutChange(),this.persistLayout(this.frontendPageLayout.getLayout())))}updateRowHeightsAndTileWidthsAfterLayoutChange(){this.rowHeights.clear(),this.updateActualHeights(),this.tileWidths.clear(),this.updateAllTileWidths();this.setLastRowRelativeHeightIfNeeded()}};function h(e){let{tomeId:t,pageId:i,pageKind:s,layout:l,tiles:d,pixelsPerHeightUnit:c,rowPadding:u,persistToBackend:p}=e;const{addController:h,getController:f,removeController:m}=(0,n.useContext)(a.Z),{apolloClient:y,clientId:v}=(0,o.bp)(),{1:w}=(0,n.useState)(0),b=()=>{w((e=>e+1))},I=(0,n.useCallback)((e=>{(0,r.T)(t,{id:i,layout:e},y,v)}),[y,v,i,t]),P=p?I:()=>{};(0,n.useEffect)((()=>()=>{m(s,i)}),[i,s,m]);const x=new Map;void 0!==d&&null!==d&&d.forEach((e=>x.set(e.id,e.type)));let T=f(s,i);return T?T.update(l,x,P,c,u):(T=new g(l,x,P,c,u,b),h(s,i,T)),T}},88989:function(e,t,i){var n=i(67294),r=i(92627);t.Z=()=>{const{scrollingPageRef:e}=(0,n.useContext)(r.Z),t=(0,n.useRef)(),i=(0,n.useRef)(!1),o=(0,n.useRef)(),a=(0,n.useCallback)(((e,t)=>e>=t-100),[]),s=(0,n.useCallback)(((e,t)=>e<t+100),[]),l=(0,n.useCallback)((()=>{o.current&&cancelAnimationFrame(o.current),i.current=!0}),[]),d=(0,n.useCallback)((function(n){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(i.current){if(r)return;i.current=!1}if(e.current){const i=e.current;null!==n&&void 0!==n&&n.clientY&&null!==n&&void 0!==n&&n.clientX&&(t.current={x:n.clientX,y:n.clientY});const r=i.getBoundingClientRect(),l=i.scrollHeight>r.height,c=i.scrollHeight-i.offsetHeight;if(!l)return;a(t.current.y,document.body.scrollHeight)&&i.scrollTop<c?(i.scrollTop+=1,o.current=requestAnimationFrame((()=>d(null,!0)))):s(t.current.y,0)&&i.scrollTop>0&&(i.scrollTop-=1,o.current=requestAnimationFrame((()=>d(null,!0))))}}),[a,s,e]);return(0,n.useMemo)((()=>({scrollContainerIfNeeded:d,cancelAnyScrolling:l})),[l,d])}},4832:function(e,t,i){i.d(t,{I:function(){return d}});var n=i(25675),r=i.n(n),o=i(67294),a=i(86062),s=i(98838),l=i(85893);const d=e=>!!e&&(e.shouldUseThemedLogo?!!e.imageUrlDark||!!e.imageUrlLight:!!e.imageUrlGlobal);t.Z=e=>{let{show:t,logo:i,theme:n}=e;const{0:d,1:c}=(0,o.useState)(!1),{UITheme:u}=(0,a.Z)(n.id,n.colors),p=((e,t)=>!e.shouldUseThemedLogo&&e.imageUrlGlobal?e.imageUrlGlobal:"light"===t&&e.imageUrlLight&&e.shouldUseThemedLogo?e.imageUrlLight:"dark"===t&&e.imageUrlDark&&e.shouldUseThemedLogo?e.imageUrlDark:void 0)(i,u);return p&&t?(0,l.jsx)(r(),{alt:"workspace-logo",draggable:!1,src:p,layout:"fixed",height:24,width:80,objectFit:"contain",objectPosition:0,loader:s.Z,style:{opacity:d?1:0},onLoad:()=>c(!0),"data-testid":"workspace_logo"}):null}},36828:function(e,t,i){i.d(t,{D:function(){return d},L:function(){return c}});var n=i(64310),r=i(50576),o=i(67294),a=i(4480),s=i(40461),l=i(34997);let d;function c(e){let{onStop:t=(()=>null)}=e;const i=(0,o.useRef)(null),c=(0,o.useRef)([]),u=(0,o.useRef)(null),p=(0,o.useRef)(null),g=(0,a.Zl)(s.fT),h=(0,a.Zl)(s.ep),f=(0,a.Zl)(s.jd),m=(0,a.Zl)(s.$6),y=(0,a.sJ)(s.LW),v=(0,a.sJ)(s.HV),w=(0,o.useCallback)((()=>{const e=[],t=[];(0,l.GE)()?navigator.mediaDevices.enumerateDevices().then((i=>{i.forEach((i=>{i.deviceId&&("audioinput"===i.kind?e.push(i):"videoinput"===i.kind&&t.push(i))})),0===e.length?f((e=>0===e.length?e:[])):f((t=>{const i=null===t||void 0===t?void 0:t.map((e=>e.deviceId)),n=null===t||void 0===t?void 0:t.map((e=>e.label));return(0,r.Z)(i,e.map((e=>e.deviceId)))&&(0,r.Z)(n,e.map((e=>e.label)))?t:e})),0===t.length?m((e=>0===e.length?e:[])):m((e=>{const i=null===e||void 0===e?void 0:e.map((e=>e.deviceId)),n=null===e||void 0===e?void 0:e.map((e=>e.label));return(0,r.Z)(i,t.map((e=>e.deviceId)))&&(0,r.Z)(n,t.map((e=>e.label)))?e:t}))})).catch((e=>{console.log(`${e.name}: ${e.message}`)})):(f((e=>0===e.length?e:[])),m((e=>0===e.length?e:[])))}),[f,m]),b=(0,o.useCallback)((async()=>{g("acquiring_media");const e={audio:!0,video:!0};y&&(e.audio={deviceId:y}),v&&(e.video={deviceId:v});try{if((0,l.t1)()){const t=await window.navigator.mediaDevices.getUserMedia(e);w(),u.current=t}g("idle"),h(d.NONE)}catch(t){n.v.addAction("getMediaStreamError",{error:t.name}),h(t.name),g("idle")}}),[g,y,v,h,w]),I=(0,o.useCallback)((async()=>{await window.navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).catch((e=>{n.v.addAction("getMediaStreamError",{error:e.name}),h(e.name),g("idle")})),w()}),[h,g,w]);(0,o.useEffect)((()=>{(0,l.DE)()||(n.v.addAction("getMediaStreamError",{error:d.UNSUPPORTED_BROWSER}),h(d.UNSUPPORTED_BROWSER)),w(),(0,l.GE)()&&(navigator.mediaDevices.ondevicechange=w)}),[w,h]);const P=(0,a._8)((e=>{let{snapshot:t}=e;return async()=>{const e=t.getLoadable(s.fT).getValue(),i="idle"===e||"stopped"===e;!u.current&&i&&await b()}}),[b]),x=(0,o.useCallback)((()=>{const e=new Blob(c.current,{type:"video/mp4"}),i=URL.createObjectURL(e);g("stopped"),t(i,e)}),[t,g]),T=e=>{let{data:t}=e;c.current.push(t)},O=(0,o.useCallback)((async()=>{if(h(d.NONE),p.current){p.current.getTracks().some((e=>"ended"===e.readyState))&&await b(),(0,l.DE)()?(i.current=new MediaRecorder(p.current),i.current.ondataavailable=T,i.current.onstop=x,i.current.onerror=()=>{h(d.NO_RECORDER),g("idle")},i.current.start(),g("recording")):(h(d.UNSUPPORTED_BROWSER),n.v.addAction("getMediaStreamError",{error:d.UNSUPPORTED_BROWSER}))}}),[b,x,h,g]),R=(0,o.useCallback)((()=>{i.current&&"inactive"!==i.current.state&&(g("stopping"),i.current.stop(),p.current&&p.current.getTracks().forEach((e=>e.stop())),u.current&&u.current.getTracks().forEach((e=>e.stop())),c.current=[])}),[g]),C=(0,o.useCallback)((()=>{u.current&&(u.current.getTracks().forEach((e=>e.stop())),u.current=null)}),[]);return(0,o.useEffect)((()=>{(y||v)&&u.current&&(C(),b())}),[y,b,C,v]),{startRecording:O,stopRecording:R,turnVideoOn:P,turnVideoOff:C,previewStream:u.current,exportStream:p,checkPermissionsAndUpdateMediaDevices:I}}!function(e){e.ABORT_ERROR="AbortError",e.NOT_ALLOWED_ERROR="NotAllowedError",e.NOT_FOUND_ERROR="NotFoundError",e.NOT_READABLE_ERROR="NotReadableError",e.OVERCONSTRAINED_ERROR="OverconstrainedError",e.TYPE_ERROR="TypeError",e.NONE="NONE",e.NO_RECORDER="recorder_error",e.UNSUPPORTED_BROWSER="unsupported_browser",e.MIME_TYPE_NOT_SUPPORTED="mime_type_not_supported"}(d||(d={}))},98982:function(e,t,i){i.d(t,{Z:function(){return r}});var n=i(67294);function r(e){const{0:t,1:i}=(0,n.useState)(!1);return(0,n.useEffect)((()=>{e>0&&i(!0)}),[e]),t}},27618:function(e,t,i){let n;i.d(t,{A:function(){return n}}),function(e){e.ADD_TILE="ADD_TILE",e.MOVE_TILE="MOVE_TILE"}(n||(n={}))},22817:function(e,t,i){i.d(t,{z:function(){return d}});var n=i(25934),r=i(51718),o=i(82326);function a(e,t){const{tomeView:i,anonymousView:n}=t;if(null!==n&&void 0!==n&&n.anonymousViews){const t=`Tome:${n.tomeId}`;e.modify({id:t,fields:{anonymousViews:()=>n.anonymousViews}})}if(!i)return;const o=e.identify(i);if(e.readFragment({id:o,fragment:r.bMw,fragmentName:"TomeActivityFragment"}))e.modify({id:o,fields:{lastTimestamp:()=>i.lastTimestamp,lastPresenceType:()=>i.lastPresenceType,active:()=>i.active,pageId:()=>i.pageId}});else{const t=`Tome:${i.tomeId}`;if(e.readFragment({id:t,fragment:r.CIe,fragmentName:"TomeViewsFragment"})){const t=e.writeFragment({id:o,fragment:r.bMw,data:i,fragmentName:"TomeActivityFragment"});e.modify({id:`Tome:${i.tomeId}`,fields:{views(){return[t,...arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]]}}})}else e.writeFragment({id:t,fragment:r.CIe,data:{__typename:"Tome",id:i.tomeId,views:[i],anonymousViews:0},fragmentName:"TomeViewsFragment"})}}function s(e,t){const i=t.identify(e);if(t.readFragment({id:i,fragment:r.bMw,fragmentName:"TomeActivityFragment"}))t.modify({id:i,fields:{lastTimestamp:()=>e.lastTimestamp,lastPresenceType:()=>e.lastPresenceType,pageId:()=>e.pageId,active:()=>e.active}});else{const n=`Page:${e.pageId}`;if(t.readFragment({id:n,fragment:r.rCt,fragmentName:"PageViewsFragment"})){const o=t.writeFragment({id:i,fragment:r.bMw,data:e,fragmentName:"TomeActivityFragment"});t.modify({id:n,fields:{views(){return[o,...arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]]}}})}else t.writeFragment({id:n,fragment:r.rCt,data:{__typename:"Page",id:e.pageId,views:[e]},fragmentName:"PageViewsFragment"})}}function l(e,t){const{pageView:i,previousPageView:n}=t;i&&s(i,e),n&&s(n,e)}const d={reportViewPresence:function(e,t,i,s){const d=e.cache.readQuery({query:r.fkZ}),{me:c}=d||{},u=(null===c||void 0===c?void 0:c.id)||t,p=c?{__typename:"User",id:c.id,name:c.name,email:c.email,profileImage:c.profileImage,pending:c.pending,createdAt:"",updatedAt:"",status:c.status,creditsAvailable:0}:{__typename:"User",id:t,name:"anonymous",email:"anonymous",profileImage:null,pending:!1,createdAt:"",updatedAt:"",status:r.J0j.Active,creditsAvailable:0},g=e.cache.readFragment({id:`TomeActivity:${i}_${u}`,fragment:r.bMw,fragmentName:"TomeActivityFragment"}),h=(new Date).toISOString();let f;g&&g.active&&g.pageId&&(f={__typename:"TomeActivity",id:`${i}_${g.pageId}_${u}`,lastPresenceType:r.NgV.TomeView,lastTimestamp:h,tomeId:i,pageId:s,userId:u,user:p,active:!1});const m={__typename:"PresenceEdit",tomeView:{__typename:"TomeActivity",id:`${i}_${u}`,lastPresenceType:r.NgV.TomeView,lastTimestamp:h,tomeId:i,pageId:s,userId:u,user:p,active:!0,isGuest:!1},pageView:{__typename:"TomeActivity",id:`${i}_${s}_${u}`,lastPresenceType:r.NgV.TomeView,lastTimestamp:h,tomeId:i,pageId:s,userId:u,user:p,active:!0,isGuest:!1},previousPageView:f};a(e.cache,m),l(e.cache,m),(0,o.Z)((()=>e.mutate({mutation:r.CHh,variables:{editId:(0,n.Z)(),clientId:t,tomeId:i,type:r.NgV.TomeView,pageId:s}})))},reportWorkspacePresence:function(e,t){const i=e.cache.readQuery({query:r.fkZ});i&&i.me&&e.mutate({mutation:r.CHh,variables:{editId:(0,n.Z)(),clientId:t,type:r.NgV.Workspace},update:(e,t)=>{let{data:i}=t;const n=null===i||void 0===i?void 0:i.reportPresence;"PresenceEdit"===(null===n||void 0===n?void 0:n.__typename)&&(a(e,n),l(e,n))}})},updateTomePresenceWithPresenceEdit:a,updatePagePresenceWithPresenceEdit:l}},77774:function(e,t,i){i.d(t,{I2:function(){return v},Np:function(){return y},XL:function(){return b},Yt:function(){return m},o1:function(){return w},w8:function(){return I}});var n=i(59499),r=i(25934),o=i(19148),a=i(51718),s=i(6748),l=i(60864);function d(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function c(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?d(Object(i),!0).forEach((function(t){(0,n.Z)(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):d(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function u(e,t){return e.cache.readFragment({id:`Page:${t}`,fragment:a.IyH,fragmentName:"PageAttributesFragment"})}function p(e){var t;const i=c(c({},e),{},{page:{overlay:c({},null===(t=e.page)||void 0===t?void 0:t.overlay)}});return delete i.page.overlay.videoUrl,delete i.page.overlay.videoThumbnailUrl,i}function g(e){return c(c({},e),{},{apply:e.apply.map((e=>p(e))),revert:e.revert.map((e=>p(e)))})}function h(e,t,i,n,r){const o=u(t,e),s=[{operation:a.C8.UpdatePage,id:e,page:{overlay:c({},null===o||void 0===o?void 0:o.overlay)}}],{overlay:l}=s[0].page;return null===i?l.videoId=null:void 0!==i&&(l.videoId=i),void 0!==n&&(l.videoStatus=n),r&&(l.position=r),s}function f(e,t,i,n){const r=u(t,e),o=[{operation:a.C8.UpdatePage,id:e,page:{overlay:c({},null===r||void 0===r?void 0:r.overlay)}}],{overlay:s}=o[0].page;return n&&(s.videoStatus=n),null===i?s.videoId=null:void 0!==i&&(s.videoId=i),o}function m(e,t,i,n){const o=h(t,i,void 0,a.Kwn.Uploaded,void 0),l=f(t,i,null,a.Kwn.WaitingForCreation),d={id:(0,r.Z)(),tomeId:e,clientId:n,apply:o,revert:l};(0,s.iO)(i,g(d),d,!0)}function y(e,t,i,n){const d=h(t,i,null,a.Kwn.WaitingForCreation,void 0),c=f(t,i,void 0,void 0),u={id:(0,r.Z)(),tomeId:e,clientId:n,apply:d,revert:c};(0,s.iO)(i,g(u),u),(0,l.ak)({message:o.ZP.t("logic.pageOverlay.recordingDeletedMessage"),action:"undo"})}function v(e,t,i,n,o){const a=h(t,i,void 0,void 0,o),l=f(t,i,void 0,void 0),d={id:(0,r.Z)(),tomeId:e,clientId:n,apply:a,revert:l};(0,s.iO)(i,g(d),d)}function w(e,t,i,n){const o=h(t,i,null,a.Kwn.WaitingForCreation,void 0),l=o,d={id:(0,r.Z)(),tomeId:e,clientId:n,apply:o,revert:l};(0,s.iO)(i,g(d),d)}function b(e,t,i,n,o){const l=h(t,n,i,a.Kwn.WaitingForUpload,void 0),d=l,c={id:(0,r.Z)(),tomeId:e,clientId:o,apply:l,revert:d};(0,s.iO)(n,g(c),c,!0)}function I(e,t,i,n,o,l){const d=h(t,n,i,a.Kwn.Uploaded,void 0),c=f(t,n,null,void 0),u={id:(0,r.Z)(),tomeId:e,clientId:o,apply:d,revert:c};(0,s.iO)(n,g(u),u,!1,l)}},46253:function(e,t,i){i.d(t,{C:function(){return n},X:function(){return r}});const n=e=>{let t=!1;if(e.dataTransfer){const i=e.dataTransfer.types;for(const e in i)if("Files"===i[e]){t=!0;break}}return t};function r(e){return void 0!==e.dataTransfer}},98838:function(e,t,i){function n(e){let{src:t,width:i,quality:n}=e;const r=["auto=format","fit=max",`w=${i}`,"fm=png"];let o="";return n&&r.push(`q=${n}`),r.length&&(o=`?${r.join("&")}`),`${t}${o}`}i.d(t,{Z:function(){return n}})},40105:function(e,t,i){i.d(t,{Z:function(){return s}});var n=i(67294),r=i(59499);class o{constructor(){(0,r.Z)(this,"map",new Map)}get(e){e:for(const[t,i]of this.map)if(t.length===e.length){for(let i=0;i<t.length;i++)if(!Object.is(t[i],e[i]))continue e;return i}}set(e,t){return this.map.set(e,t),t}}var a=function(e){const t=new o;return function i(){for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];const a=t.get(r);return void 0!==a?a:r.length>=e.length?t.set(r,e.apply(this,r)):t.set(r,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i.apply(this,r.concat(t))}))}};var s=function(e,t){return(0,n.useMemo)((()=>a(e)),t)}}}]);
